<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BUNME - åˆ†èº«è‚²æˆã‚²ãƒ¼ãƒ </title>
    <style>
        /* ===== CSS Variables ===== */
        :root {
            --primary-color: #8b5cf6;
            --secondary-color: #f59e0b;
            --dark-bg: #0c0c1d;
            --darker-bg: #060612;
            --card-bg: #1a1a3e;
            --monster-color: #dc2626;
            --hero-color: #3b82f6;
            --text-light: #f1f5f9;
            --text-muted: #94a3b8;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --gold-accent: #fbbf24;
            --mystic-glow: rgba(139, 92, 246, 0.3);
        }

        /* ===== Mystical Background Effect ===== */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(ellipse at 20% 80%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(245, 158, 11, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(59, 130, 246, 0.05) 0%, transparent 70%);
            pointer-events: none;
            z-index: -1;
        }

        /* ===== Floating Particles ===== */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: -1;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--gold-accent);
            border-radius: 50%;
            opacity: 0.3;
            animation: float 15s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.3; }
            90% { opacity: 0.3; }
            100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }
        }

        /* ===== Reset & Base ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            background: linear-gradient(135deg, var(--dark-bg) 0%, var(--darker-bg) 100%);
            color: var(--text-light);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* ===== Layout ===== */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== Header ===== */
        .header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 2px solid var(--primary-color);
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: var(--text-muted);
            margin-top: 10px;
        }

        /* ===== Progress Bar ===== */
        .progress-container {
            background: var(--darker-bg);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .progress-step {
            font-size: 0.8em;
            color: var(--text-muted);
            text-align: center;
            flex: 1;
        }

        .progress-step.active {
            color: var(--secondary-color);
            font-weight: bold;
        }

        .progress-step.completed {
            color: var(--success-color);
        }

        .progress-bar {
            height: 8px;
            background: var(--card-bg);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 0.5s ease;
        }

        /* ===== Buttons ===== */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), #805ad5);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(107, 70, 193, 0.4);
        }

        .btn-secondary {
            background: var(--card-bg);
            color: var(--text-light);
            border: 2px solid var(--primary-color);
        }

        .btn-secondary:hover {
            background: var(--primary-color);
        }

        .btn-monster {
            background: linear-gradient(135deg, var(--monster-color), #c53030);
            color: white;
        }

        .btn-hero {
            background: linear-gradient(135deg, var(--hero-color), #3182ce);
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ===== Forms ===== */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--text-light);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--card-bg);
            border-radius: 8px;
            background: var(--darker-bg);
            color: var(--text-light);
            font-size: 1em;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* ===== Cards ===== */
        .card {
            background: linear-gradient(145deg, var(--card-bg), rgba(26, 26, 62, 0.8));
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(139, 92, 246, 0.3);
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .card:hover {
            border-color: var(--gold-accent);
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(139, 92, 246, 0.2);
        }

        .card-monster {
            border-left: 4px solid var(--monster-color);
        }

        .card-hero {
            border-left: 4px solid var(--hero-color);
        }

        .card-skill {
            border-left: 4px solid var(--success-color);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 1.2em;
            font-weight: bold;
        }

        .card-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .badge-monster {
            background: var(--monster-color);
        }

        .badge-hero {
            background: var(--hero-color);
        }

        .badge-skill {
            background: var(--success-color);
        }

        /* ===== Tarot Card Style ===== */
        .tarot-card {
            background: linear-gradient(135deg, #1a1a3e 0%, #0f0f2d 100%);
            border: 3px solid var(--gold-accent);
            border-radius: 16px;
            padding: 25px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease;
            box-shadow:
                0 10px 40px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .tarot-card::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            bottom: 8px;
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 12px;
            pointer-events: none;
        }

        .tarot-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 50% 0%, rgba(251, 191, 36, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .tarot-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow:
                0 20px 60px rgba(139, 92, 246, 0.3),
                0 0 40px rgba(251, 191, 36, 0.2);
        }

        .tarot-card .card-icon {
            font-size: 3em;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
            filter: drop-shadow(0 0 10px rgba(251, 191, 36, 0.5));
        }

        .tarot-card .card-name {
            font-size: 1.1em;
            font-weight: bold;
            color: var(--gold-accent);
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }

        .tarot-card .card-desc {
            font-size: 0.85em;
            color: var(--text-muted);
            position: relative;
            z-index: 1;
        }

        .tarot-card.monster-type {
            border-color: var(--monster-color);
        }

        .tarot-card.monster-type .card-name {
            color: #f87171;
        }

        .tarot-card.hero-type {
            border-color: var(--hero-color);
        }

        .tarot-card.hero-type .card-name {
            color: #60a5fa;
        }

        .tarot-card.skill-type {
            border-color: var(--success-color);
        }

        .tarot-card.skill-type .card-name {
            color: #34d399;
        }

        /* ===== Character Card Display ===== */
        .character-card {
            background: linear-gradient(135deg, var(--darker-bg), var(--card-bg));
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            border: 3px solid var(--secondary-color);
            position: relative;
            overflow: hidden;
        }

        .character-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(107, 70, 193, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .character-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            position: relative;
            z-index: 1;
        }

        .character-name {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .character-title {
            color: var(--secondary-color);
            font-size: 1em;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        /* ===== Quiz Options ===== */
        .quiz-options {
            display: grid;
            gap: 10px;
        }

        .quiz-option {
            padding: 15px 20px;
            background: var(--card-bg);
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .quiz-option:hover {
            border-color: var(--primary-color);
            background: var(--darker-bg);
        }

        .quiz-option.selected {
            border-color: var(--secondary-color);
            background: rgba(214, 158, 46, 0.2);
        }

        /* ===== Card Grid ===== */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .mini-card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .mini-card:hover {
            transform: scale(1.05);
        }

        .mini-card.selected {
            border-color: var(--secondary-color);
            box-shadow: 0 0 20px rgba(214, 158, 46, 0.3);
        }

        .mini-card-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .mini-card-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .mini-card-desc {
            font-size: 0.8em;
            color: var(--text-muted);
        }

        /* ===== Quest List ===== */
        .quest-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quest-item:hover {
            background: var(--darker-bg);
        }

        .quest-item.completed {
            opacity: 0.6;
        }

        .quest-icon {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            margin-right: 15px;
        }

        .quest-icon.monster {
            background: var(--monster-color);
        }

        .quest-icon.hero {
            background: var(--hero-color);
        }

        .quest-info {
            flex: 1;
        }

        .quest-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .quest-desc {
            font-size: 0.9em;
            color: var(--text-muted);
        }

        .quest-status {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8em;
        }

        .status-pending {
            background: var(--warning-color);
        }

        .status-completed {
            background: var(--success-color);
        }

        /* ===== Activity Log ===== */
        .activity-log {
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: var(--darker-bg);
            border-radius: 8px;
        }

        .activity-entry {
            padding: 10px;
            border-bottom: 1px solid var(--card-bg);
            font-size: 0.9em;
        }

        .activity-entry:last-child {
            border-bottom: none;
        }

        .activity-date {
            color: var(--text-muted);
            font-size: 0.8em;
        }

        /* ===== Stats Display ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .stat-box {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: var(--secondary-color);
        }

        .stat-label {
            font-size: 0.9em;
            color: var(--text-muted);
        }

        /* ===== Path Selection ===== */
        .path-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .path-option {
            padding: 30px 20px;
            background: var(--card-bg);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .path-option:hover {
            border-color: var(--primary-color);
            transform: translateY(-5px);
        }

        .path-option.selected {
            border-color: var(--secondary-color);
        }

        .path-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .path-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .path-desc {
            font-size: 0.9em;
            color: var(--text-muted);
        }

        /* ===== Content Generator ===== */
        .content-output {
            background: var(--darker-bg);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid var(--secondary-color);
        }

        .content-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .content-type-btn {
            padding: 8px 16px;
            border-radius: 20px;
            background: var(--card-bg);
            color: var(--text-light);
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .content-type-btn.active {
            background: var(--primary-color);
        }

        /* ===== Deck Display ===== */
        .deck-container {
            background: var(--darker-bg);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .deck-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .deck-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .deck-card {
            padding: 8px 12px;
            background: var(--card-bg);
            border-radius: 6px;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* ===== Navigation ===== */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--card-bg);
        }

        /* ===== Modal ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--darker-bg);
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.5em;
            cursor: pointer;
        }

        /* ===== Tabs ===== */
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--card-bg);
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.3s ease;
        }

        .tab.active {
            border-bottom-color: var(--primary-color);
            color: var(--secondary-color);
        }

        /* ===== Responsive ===== */
        @media (max-width: 600px) {
            .path-selection {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .card-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }
        }

        /* ===== Utility ===== */
        .text-center {
            text-align: center;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .hidden {
            display: none !important;
        }

        /* ===== Binary Choice (Swipe UI) ===== */
        .binary-choice-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            align-items: stretch;
            margin: 30px 0;
            perspective: 1000px;
        }

        .choice-card {
            flex: 1;
            max-width: 280px;
            background: linear-gradient(135deg, #1a1a3e 0%, #0f0f2d 100%);
            border: 3px solid rgba(139, 92, 246, 0.3);
            border-radius: 16px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .choice-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 50% 0%, rgba(139, 92, 246, 0.1) 0%, transparent 60%);
            pointer-events: none;
        }

        .choice-card:hover {
            transform: translateY(-10px) scale(1.05);
            border-color: var(--gold-accent);
            box-shadow:
                0 20px 60px rgba(0, 0, 0, 0.4),
                0 0 30px rgba(251, 191, 36, 0.2);
        }

        .choice-card.selected {
            border-color: var(--gold-accent);
            background: linear-gradient(135deg, #2a2a5e 0%, #1a1a4d 100%);
            transform: scale(1.05);
        }

        .choice-card.swiped-left {
            animation: swipeLeft 0.5s ease forwards;
        }

        .choice-card.swiped-right {
            animation: swipeRight 0.5s ease forwards;
        }

        @keyframes swipeLeft {
            to {
                transform: translateX(-150%) rotate(-20deg);
                opacity: 0;
            }
        }

        @keyframes swipeRight {
            to {
                transform: translateX(150%) rotate(20deg);
                opacity: 0;
            }
        }

        .choice-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            filter: drop-shadow(0 0 10px rgba(139, 92, 246, 0.5));
        }

        .choice-text {
            font-size: 0.95em;
            color: var(--text-light);
            line-height: 1.5;
        }

        .choice-hint {
            font-size: 0.8em;
            color: var(--text-muted);
            margin-top: 15px;
        }

        .vs-divider {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            color: var(--gold-accent);
            text-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
        }

        /* ===== Mystic Feedback ===== */
        .mystic-feedback {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(59, 130, 246, 0.1));
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            animation: fadeInUp 0.6s ease;
        }

        .mystic-feedback p {
            font-style: italic;
            color: var(--gold-accent);
            font-size: 1.1em;
            margin: 0;
        }

        .mystic-feedback .insight {
            color: var(--text-light);
            font-size: 0.9em;
            margin-top: 10px;
            font-style: normal;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ===== Enhanced Header ===== */
        .header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 2px solid transparent;
            border-image: linear-gradient(90deg, transparent, var(--gold-accent), transparent) 1;
            margin-bottom: 30px;
            position: relative;
        }

        .header::before {
            content: 'âœ§';
            position: absolute;
            left: 50%;
            bottom: -12px;
            transform: translateX(-50%);
            color: var(--gold-accent);
            font-size: 1.2em;
        }

        .header h1 {
            font-size: 2.8em;
            background: linear-gradient(90deg, var(--gold-accent), #fef3c7, var(--gold-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: none;
            letter-spacing: 0.1em;
        }

        .header p {
            color: var(--text-muted);
            margin-top: 10px;
            font-size: 0.95em;
        }

        /* ===== Mystical Section Titles ===== */
        .section-title {
            position: relative;
            display: inline-block;
            margin-bottom: 20px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--gold-accent), transparent);
        }

        /* ===== Mobile Swipe Support ===== */
        @media (max-width: 600px) {
            .binary-choice-container {
                flex-direction: column;
                align-items: center;
            }

            .choice-card {
                max-width: 100%;
                width: 100%;
            }

            .vs-divider {
                padding: 10px 0;
            }
        }
    </style>
</head>
<body>
    <!-- Floating Particles -->
    <div class="particles" id="particles"></div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>BUNME</h1>
            <p>é­‚ã®éŒ¬æˆ â”€ ãƒ‡ã‚¸ã‚¿ãƒ«åˆ†èº«è‚²æˆã®æ›¸</p>
        </header>

        <!-- Progress Bar -->
        <div class="progress-container" id="progressContainer">
            <div class="progress-steps">
                <span class="progress-step" data-step="1">è¨ºæ–­</span>
                <span class="progress-step" data-step="2">ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ</span>
                <span class="progress-step" data-step="3">ã‚¯ã‚¨ã‚¹ãƒˆ</span>
                <span class="progress-step" data-step="4">è¨˜éŒ²</span>
                <span class="progress-step" data-step="5">ç™ºä¿¡</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
        </div>

        <!-- Screen 1: Welcome -->
        <div class="screen active" id="screen-welcome">
            <div class="character-card">
                <div class="character-avatar">ğŸ”®</div>
                <h2 class="character-name">é­‚ã®éŒ¬æˆæ‰€ã¸ã‚ˆã†ã“ã</h2>
                <p class="character-title">è‡ªåˆ†ã‚’çŸ¥ã‚‹å†’é™ºãŒã€æœ€å¼·ã®æ­¦å™¨ï¼ˆåˆ†èº«ï¼‰ã‚’ä½œã‚‹</p>
            </div>
            <div class="card mt-20">
                <h3>âœ§ BUNMEã¨ã¯ï¼Ÿ</h3>
                <p class="mt-20">ã‚ãªãŸã®æ€è€ƒã€å—œå¥½ã€æ–‡ä½“ã‚’ã€Œã‚«ãƒ¼ãƒ‰ã€ã¨ã—ã¦åé›†ã—ã€ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ»ã‚¯ãƒ­ãƒ¼ãƒ³ï¼ˆåˆ†èº«ï¼‰ã‚’éŒ¬æˆã™ã‚‹é­”å°æ›¸ã§ã™ã€‚</p>
                <ul style="margin: 15px 0 15px 20px;">
                    <li><strong>ãƒ€ãƒ¼ã‚¯ã‚«ãƒ¼ãƒ‰ï¼ˆå½±ï¼‰</strong>ï¼šå«Œã„ãªã“ã¨ã€è¨±ã›ãªã„ã“ã¨ã€ã‚¹ãƒˆãƒ¬ã‚¹ã®æº</li>
                    <li><strong>ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚«ãƒ¼ãƒ‰ï¼ˆå…‰ï¼‰</strong>ï¼šå¥½ããªã“ã¨ã€å¾—æ„ãªã“ã¨ã€å¤§åˆ‡ãªä¾¡å€¤è¦³</li>
                    <li><strong>ã‚¹ã‚­ãƒ«ãƒ»ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆ</strong>ï¼šäººç”Ÿã§ç²å¾—ã—ãŸæˆæœã‚„æŠ€è¡“</li>
                    <li><strong>æ–‡ä½“DNA</strong>ï¼šã‚ãªãŸã ã‘ã®è¨€è‘‰é£ã„ã¨æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³</li>
                </ul>
            </div>
            <div class="mystic-feedback">
                <p>ã€Œå›ã®æ·±å±¤ã‚’è¦—ãæº–å‚™ã¯ã§ããŸã‹ï¼Ÿã€</p>
            </div>
            <div class="text-center mt-20">
                <button class="btn btn-primary" onclick="goToScreen('screen-register')">éŒ¬æˆã‚’é–‹å§‹ã™ã‚‹</button>
            </div>
        </div>

        <!-- Screen 2: Registration -->
        <div class="screen" id="screen-register">
            <h2 class="mb-20">STEP 1: è¨ºæ–­ã®æ´çªŸ</h2>
            <p class="mb-20" style="color: var(--text-muted);">ã¾ãšã¯åŸºæœ¬æƒ…å ±ã‚’ç™»éŒ²ã—ã¦ã€ã‚ãªãŸã®åˆ†èº«ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚</p>

            <div class="form-group">
                <label for="userName">å†’é™ºè€…ã®åå‰</label>
                <input type="text" id="userName" placeholder="ã‚ãªãŸã®åå‰ã‚’å…¥åŠ›">
            </div>

            <div class="form-group">
                <label for="userAge">å¹´é½¢</label>
                <select id="userAge">
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value="10s">10ä»£</option>
                    <option value="20s">20ä»£</option>
                    <option value="30s">30ä»£</option>
                    <option value="40s">40ä»£</option>
                    <option value="50s">50ä»£ä»¥ä¸Š</option>
                </select>
            </div>

            <div class="form-group">
                <label for="userGoal">ç¾åœ¨ã®ç›®æ¨™ã‚„èˆˆå‘³ï¼ˆä»»æ„ï¼‰</label>
                <textarea id="userGoal" placeholder="ä»Šå–ã‚Šçµ„ã‚“ã§ã„ã‚‹ã“ã¨ã‚„èˆˆå‘³ãŒã‚ã‚‹ã“ã¨ã‚’è‡ªç”±ã«æ›¸ã„ã¦ãã ã•ã„"></textarea>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToScreen('screen-welcome')">æˆ»ã‚‹</button>
                <button class="btn btn-primary" onclick="saveRegistration()">æ¬¡ã¸</button>
            </div>
        </div>

        <!-- Screen 3: Quiz (Binary Choice) -->
        <div class="screen" id="screen-quiz">
            <h2 class="mb-20">âœ§ äºŒè€…æŠä¸€ã®è©¦ç·´</h2>
            <p class="mb-20" style="color: var(--text-muted);">ç›´æ„Ÿã§é¸ã¹ã€‚å›ã®æ·±å±¤å¿ƒç†ãŒã€ã‚«ãƒ¼ãƒ‰ã¨ãªã£ã¦ç¾ã‚Œã‚‹ã€‚</p>

            <div id="quizContainer">
                <p id="quizQuestion" style="font-size: 1.1em; margin-bottom: 20px; text-align: center; color: var(--gold-accent);"></p>

                <div class="binary-choice-container" id="binaryChoiceContainer">
                    <div class="choice-card" id="choiceLeft" onclick="selectBinaryChoice(0)">
                        <div class="choice-icon" id="choiceLeftIcon">âš¡</div>
                        <div class="choice-text" id="choiceLeftText"></div>
                    </div>
                    <div class="vs-divider">VS</div>
                    <div class="choice-card" id="choiceRight" onclick="selectBinaryChoice(1)">
                        <div class="choice-icon" id="choiceRightIcon">ğŸŒ™</div>
                        <div class="choice-text" id="choiceRightText"></div>
                    </div>
                </div>

                <div id="mysticFeedbackContainer"></div>

                <div class="text-center mt-20">
                    <span id="quizProgress" style="color: var(--text-muted);">1 / 10</span>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToScreen('screen-register')">æˆ»ã‚‹</button>
            </div>
        </div>

        <!-- Screen 4: Card Generation -->
        <div class="screen" id="screen-cards">
            <h2 class="mb-20">âœ§ ã‚«ãƒ¼ãƒ‰å¬å–šã®ç¥­å£‡</h2>
            <p class="mb-20" style="color: var(--text-muted);">è©¦ç·´ã®çµæœã€å›ã®é­‚ã‹ã‚‰ã‚«ãƒ¼ãƒ‰ãŒå¬å–šã•ã‚ŒãŸ...</p>

            <div id="cardRevealFeedback"></div>

            <div class="deck-container">
                <div class="deck-title">
                    <span style="color: var(--monster-color);">ğŸŒ‘</span>
                    ãƒ€ãƒ¼ã‚¯ã‚«ãƒ¼ãƒ‰ï¼ˆå½±ã®æ€§è³ªï¼‰
                </div>
                <div class="card-grid" id="monsterCards"></div>
            </div>

            <div class="deck-container">
                <div class="deck-title">
                    <span style="color: var(--hero-color);">â˜€ï¸</span>
                    ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚«ãƒ¼ãƒ‰ï¼ˆå…‰ã®æ€§è³ªï¼‰
                </div>
                <div class="card-grid" id="heroCards"></div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToScreen('screen-quiz')">æˆ»ã‚‹</button>
                <button class="btn btn-primary" onclick="goToScreen('screen-path')">æ¬¡ã¸</button>
            </div>
        </div>

        <!-- Screen 5: Path Selection -->
        <div class="screen" id="screen-path">
            <h2 class="mb-20">å†’é™ºã®é“ã‚’é¸æŠ</h2>
            <p class="mb-20" style="color: var(--text-muted);">ã‚ãªãŸã®ç¾åœ¨ã®çŠ¶æ³ã«åˆã‚ã›ã¦é“ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>

            <div class="path-selection">
                <div class="path-option" onclick="selectPath('defined')" id="path-defined">
                    <div class="path-icon">ğŸ¯</div>
                    <div class="path-title">ã‚„ã‚ŠãŸã„ã“ã¨ãŒæ±ºã¾ã£ã¦ã„ã‚‹</div>
                    <div class="path-desc">ç›®æ¨™ã«å‘ã‹ã£ã¦ã‚¯ã‚¨ã‚¹ãƒˆã«æŒ‘æˆ¦ã—ã€èª²é¡Œã‚’å…‹æœã—ã¦ã„ã</div>
                </div>
                <div class="path-option" onclick="selectPath('exploring')" id="path-exploring">
                    <div class="path-icon">ğŸ”</div>
                    <div class="path-title">ã¾ã æ¢ã—ã¦ã„ã‚‹</div>
                    <div class="path-desc">è¶£å‘³å—œå¥½ã«åˆã£ãŸæ´»å‹•ã‚’ææ¡ˆã•ã‚Œã€æ–°ã—ã„ç™ºè¦‹ã‚’ã™ã‚‹</div>
                </div>
            </div>

            <div id="definedPathInput" class="hidden">
                <div class="form-group">
                    <label for="userActivity">ã‚„ã‚ŠãŸã„ã“ã¨ãƒ»å–ã‚Šçµ„ã‚“ã§ã„ã‚‹æ´»å‹•</label>
                    <textarea id="userActivity" placeholder="å…·ä½“çš„ã«æ•™ãˆã¦ãã ã•ã„ï¼ˆä¾‹ï¼šãƒ–ãƒ­ã‚°ã§æƒ…å ±ç™ºä¿¡ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å­¦ç¿’ã€å‰¯æ¥­ã®ç«‹ã¡ä¸Šã’ ãªã©ï¼‰"></textarea>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToScreen('screen-cards')">æˆ»ã‚‹</button>
                <button class="btn btn-primary" onclick="confirmPath()" id="pathNextBtn" disabled>æ¬¡ã¸</button>
            </div>
        </div>

        <!-- Screen 6: Quest Dashboard -->
        <div class="screen" id="screen-quests">
            <h2 class="mb-20">ã‚¯ã‚¨ã‚¹ãƒˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-value" id="completedQuests">0</div>
                    <div class="stat-label">å®Œäº†ã‚¯ã‚¨ã‚¹ãƒˆ</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="totalRecords">0</div>
                    <div class="stat-label">æ´»å‹•è¨˜éŒ²æ•°</div>
                </div>
            </div>

            <div class="tabs">
                <div class="tab active" onclick="switchQuestTab('monster')">ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼è¨ä¼</div>
                <div class="tab" onclick="switchQuestTab('hero')">ãƒ’ãƒ¼ãƒ­ãƒ¼è‚²æˆ</div>
            </div>

            <div id="questList"></div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToScreen('screen-path')">æˆ»ã‚‹</button>
                <button class="btn btn-primary" onclick="goToScreen('screen-records')">æ´»å‹•è¨˜éŒ²ã¸</button>
            </div>
        </div>

        <!-- Screen 7: Activity Records -->
        <div class="screen" id="screen-records">
            <h2 class="mb-20">STEP 3: è¨˜éŒ²ã®éŒ¬é‡‘è¡“</h2>
            <p class="mb-20" style="color: var(--text-muted);">æ´»å‹•ã‚’è¨˜éŒ²ã—ã¦ã€ã‚ãªãŸã®æ–‡ä½“ã‚’åé›†ã—ã¾ã™ã€‚</p>

            <div class="card">
                <h3 class="mb-20">æ–°ã—ã„æ´»å‹•ã‚’è¨˜éŒ²</h3>
                <div class="form-group">
                    <label for="recordTitle">æ´»å‹•ã‚¿ã‚¤ãƒˆãƒ«</label>
                    <input type="text" id="recordTitle" placeholder="ä½•ã‚’ã—ã¾ã—ãŸã‹ï¼Ÿ">
                </div>
                <div class="form-group">
                    <label for="recordContent">è©³ç´°ãƒ»æ„Ÿæƒ³</label>
                    <textarea id="recordContent" placeholder="ã©ã‚“ãªã“ã¨ã‚’ã—ã¦ã€ã©ã†æ„Ÿã˜ã¾ã—ãŸã‹ï¼Ÿè‡ªç”±ã«æ›¸ã„ã¦ãã ã•ã„ã€‚"></textarea>
                </div>
                <div class="form-group">
                    <label for="recordQuest">é–¢é€£ã‚¯ã‚¨ã‚¹ãƒˆ</label>
                    <select id="recordQuest">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="saveRecord()">è¨˜éŒ²ã‚’ä¿å­˜</button>
            </div>

            <h3 class="mt-20 mb-20">æ´»å‹•å±¥æ­´</h3>
            <div class="activity-log" id="activityLog">
                <p style="color: var(--text-muted); text-align: center;">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToScreen('screen-quests')">æˆ»ã‚‹</button>
                <button class="btn btn-primary" onclick="goToScreen('screen-content')">ç™ºä¿¡ã¸</button>
            </div>
        </div>

        <!-- Screen 8: Content Generation -->
        <div class="screen" id="screen-content">
            <h2 class="mb-20">ç™ºä¿¡ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆ</h2>
            <p class="mb-20" style="color: var(--text-muted);">ã‚ãªãŸã®æ´»å‹•è¨˜éŒ²ã‹ã‚‰ç™ºä¿¡ç”¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆã—ã¾ã™ã€‚</p>

            <div class="content-type-selector">
                <button class="content-type-btn active" onclick="selectContentType('blog')">ãƒ–ãƒ­ã‚°</button>
                <button class="content-type-btn" onclick="selectContentType('sns')">SNSæŠ•ç¨¿</button>
                <button class="content-type-btn" onclick="selectContentType('newsletter')">ãƒ¡ãƒ«ãƒã‚¬</button>
            </div>

            <div class="form-group">
                <label for="contentTopic">ãƒ†ãƒ¼ãƒã‚’é¸æŠ</label>
                <select id="contentTopic">
                    <option value="">æ´»å‹•è¨˜éŒ²ã‹ã‚‰é¸æŠ</option>
                </select>
            </div>

            <button class="btn btn-primary mb-20" onclick="generateContent()">ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆ</button>

            <div class="content-output" id="contentOutput">
                <p style="color: var(--text-muted);">ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToScreen('screen-records')">æˆ»ã‚‹</button>
                <button class="btn btn-primary" onclick="goToScreen('screen-goal')">ã‚´ãƒ¼ãƒ«ã¸</button>
            </div>
        </div>

        <!-- Screen 9: Goal & Review -->
        <div class="screen" id="screen-goal">
            <h2 class="mb-20">GOAL: æŒ¯ã‚Šè¿”ã‚Šï¼†æœªæ¥ã¸</h2>

            <div class="character-card">
                <div class="character-avatar" id="goalAvatar">ğŸ†</div>
                <h2 class="character-name" id="goalName">å†’é™ºè€…</h2>
                <p class="character-title" id="goalTitle">æˆé•·ã™ã‚‹æ¢æ±‚è€…</p>
            </div>

            <div class="stats-grid mt-20">
                <div class="stat-box">
                    <div class="stat-value" id="finalQuests">0</div>
                    <div class="stat-label">ã‚¯ã‚¨ã‚¹ãƒˆå®Œäº†</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="finalRecords">0</div>
                    <div class="stat-label">æ´»å‹•è¨˜éŒ²</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="finalContents">0</div>
                    <div class="stat-label">ç”Ÿæˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="finalSkills">0</div>
                    <div class="stat-label">ç²å¾—ã‚¹ã‚­ãƒ«</div>
                </div>
            </div>

            <div class="deck-container">
                <div class="deck-title">
                    <span style="color: var(--success-color);">â­</span>
                    ç²å¾—ã‚¹ã‚­ãƒ«ã‚«ãƒ¼ãƒ‰
                </div>
                <div class="card-grid" id="skillCards"></div>
            </div>

            <div class="card mt-20">
                <h3 class="mb-20">æ¬¡ã®å‘¨å›ã¸</h3>
                <p style="color: var(--text-muted);">ä»Šå›ã®å†’é™ºã§å¾—ãŸçµŒé¨“ã‚’æ´»ã‹ã—ã¦ã€ã•ã‚‰ãªã‚‹æˆé•·ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ï¼</p>
                <button class="btn btn-primary mt-20" onclick="startNewCycle()">2å‘¨ç›®ã‚’é–‹å§‹</button>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToScreen('screen-content')">æˆ»ã‚‹</button>
                <button class="btn btn-secondary" onclick="exportData()">ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
            </div>
        </div>

        <!-- Quest Modal -->
        <div class="modal" id="questModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalQuestTitle">ã‚¯ã‚¨ã‚¹ãƒˆè©³ç´°</h3>
                    <button class="modal-close" onclick="closeModal()">&times;</button>
                </div>
                <p id="modalQuestDesc" class="mb-20"></p>
                <div class="form-group">
                    <label for="questNote">ã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒ¢</label>
                    <textarea id="questNote" placeholder="ã“ã®ã‚¯ã‚¨ã‚¹ãƒˆã«ã¤ã„ã¦ã®ãƒ¡ãƒ¢ã‚’æ®‹ã™"></textarea>
                </div>
                <div class="text-center">
                    <button class="btn btn-primary" onclick="completeQuest()">ã‚¯ã‚¨ã‚¹ãƒˆå®Œäº†</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== Game State =====
        let gameState = {
            currentScreen: 'screen-welcome',
            user: {
                name: '',
                age: '',
                goal: '',
                activity: '',
                path: ''
            },
            quizAnswers: [],
            monsterCards: [],
            heroCards: [],
            skillCards: [],
            quests: [],
            records: [],
            generatedContents: [],
            cycle: 1,
            currentQuestTab: 'monster',
            selectedQuest: null
        };

        // ===== Quiz Data (Binary Choice Format) =====
        const quizQuestions = [
            {
                question: "ä»•äº‹ã®é€²ã‚æ–¹",
                leftIcon: "âš¡",
                rightIcon: "ğŸ¯",
                options: [
                    { text: "ãƒªã‚¹ã‚¯ã¯ã‚ã‚‹ãŒåˆºæ¿€çš„ãªä»•äº‹", dark: 0, hero: 2 },
                    { text: "å®Œç’§ãªè¨ˆç”»ã ãŒé€€å±ˆãªä»•äº‹", dark: 1, hero: 1 }
                ]
            },
            {
                question: "æ–°ã—ã„æŒ‘æˆ¦ã¸ã®å§¿å‹¢",
                leftIcon: "ğŸš€",
                rightIcon: "ğŸ”",
                options: [
                    { text: "ã¨ã‚Šã‚ãˆãšå§‹ã‚ã¦ã‹ã‚‰è€ƒãˆã‚‹", dark: 0, hero: 2 },
                    { text: "ååˆ†ã«æº–å‚™ã—ã¦ã‹ã‚‰å§‹ã‚ã‚‹", dark: 1, hero: 1 }
                ]
            },
            {
                question: "å›°é›£ã«ç›´é¢ã—ãŸã¨ã",
                leftIcon: "âš”ï¸",
                rightIcon: "ğŸ›¡ï¸",
                options: [
                    { text: "æ­£é¢ã‹ã‚‰ç«‹ã¡å‘ã‹ã†", dark: 0, hero: 2 },
                    { text: "å›é¿ç­–ã‚’æ¢ã™", dark: 1, hero: 1 }
                ]
            },
            {
                question: "äººã¨ã®é–¢ã‚ã‚Šæ–¹",
                leftIcon: "ğŸ‘¥",
                rightIcon: "ğŸ”ï¸",
                options: [
                    { text: "ãƒãƒ¼ãƒ ã§å”åŠ›ã—ãŸã„", dark: 0, hero: 2 },
                    { text: "ä¸€äººã§é›†ä¸­ã—ãŸã„", dark: 1, hero: 1 }
                ]
            },
            {
                question: "å¤±æ•—ã¸ã®å‘ãåˆã„æ–¹",
                leftIcon: "ğŸ”¥",
                rightIcon: "ğŸ’­",
                options: [
                    { text: "ã™ãæ¬¡ã«åˆ‡ã‚Šæ›¿ãˆã‚‹", dark: 0, hero: 2 },
                    { text: "æ·±ãåˆ†æã—ã¦å­¦ã¶", dark: 1, hero: 1 }
                ]
            },
            {
                question: "æƒ…å ±åé›†ã®ã‚¹ã‚¿ã‚¤ãƒ«",
                leftIcon: "ğŸ“š",
                rightIcon: "ğŸ—£ï¸",
                options: [
                    { text: "è‡ªåˆ†ã§å¾¹åº•çš„ã«èª¿ã¹ã‚‹", dark: 0, hero: 2 },
                    { text: "è©³ã—ã„äººã«èã", dark: 1, hero: 1 }
                ]
            },
            {
                question: "ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã®æº",
                leftIcon: "ğŸ†",
                rightIcon: "â¤ï¸",
                options: [
                    { text: "é”æˆæ„Ÿã‚„è‡ªå·±æˆé•·", dark: 0, hero: 2 },
                    { text: "äººã‹ã‚‰ã®æ„Ÿè¬ã‚„è©•ä¾¡", dark: 1, hero: 1 }
                ]
            },
            {
                question: "è¡¨ç¾ã®å¾—æ„åˆ†é‡",
                leftIcon: "ğŸ¤",
                rightIcon: "âœï¸",
                options: [
                    { text: "è©±ã—ã¦ä¼ãˆã‚‹", dark: 0, hero: 2 },
                    { text: "æ›¸ã„ã¦ä¼ãˆã‚‹", dark: 1, hero: 1 }
                ]
            },
            {
                question: "ã‚¢ã‚¤ãƒ‡ã‚¢ã®ç”Ÿã¿å‡ºã—æ–¹",
                leftIcon: "âœ¨",
                rightIcon: "ğŸ”§",
                options: [
                    { text: "ã‚¼ãƒ­ã‹ã‚‰å‰µé€ ã™ã‚‹", dark: 0, hero: 2 },
                    { text: "æ—¢å­˜ã‚’æ”¹è‰¯ã™ã‚‹", dark: 1, hero: 1 }
                ]
            },
            {
                question: "ã‚¹ãƒˆãƒ¬ã‚¹æ™‚ã®åå¿œ",
                leftIcon: "ğŸƒ",
                rightIcon: "ğŸ§˜",
                options: [
                    { text: "ä½“ã‚’å‹•ã‹ã—ã¦ç™ºæ•£", dark: 0, hero: 2 },
                    { text: "é™ã‹ã«å†…çœã™ã‚‹", dark: 1, hero: 1 }
                ]
            }
        ];

        // ===== Mystic Feedback Messages =====
        const mysticFeedbacks = [
            { message: "èˆˆå‘³æ·±ã„...å›ã«ã¯è¡Œå‹•åŠ›ã®ç‚ãŒå®¿ã£ã¦ã„ã‚‹ã‚ˆã†ã ", insight: "ç›´æ„Ÿçš„ãªåˆ¤æ–­ã‚’ä¿¡ã˜ã‚‹å‚¾å‘ãŒã‚ã‚‹" },
            { message: "ãªã‚‹ã»ã©...æ…é‡ã•ã¨å¤§èƒ†ã•ã®ãƒãƒ©ãƒ³ã‚¹ãŒè¦‹ãˆã‚‹", insight: "çŠ¶æ³ã«å¿œã˜ã¦æˆ¦ç•¥ã‚’å¤‰ãˆã‚‰ã‚Œã‚‹" },
            { message: "ãµã‚€...å›ã®å†…ãªã‚‹å£°ãŒã¯ã£ãã‚Šã¨èã“ãˆã¦ããŸ", insight: "è‡ªå·±ç†è§£ãŒæ·±ã¾ã‚Šã¤ã¤ã‚ã‚‹" },
            { message: "ã“ã‚Œã¯äºˆæƒ³å¤–ã ...éš ã‚ŒãŸæƒ…ç†±ãŒå£é–“è¦‹ãˆã‚‹", insight: "è¡¨é¢ã«å‡ºãªã„å¼·ã„æ„å¿—ãŒã‚ã‚‹" },
            { message: "é¢ç™½ã„...è«–ç†ã¨ç›´æ„ŸãŒäº¤éŒ¯ã—ã¦ã„ã‚‹", insight: "è¤‡é›‘ãªæ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³ã®æŒã¡ä¸»" },
            { message: "æ·±ã„...å›ã®é¸æŠã«ã¯ä¸€è²«æ€§ãŒã‚ã‚‹", insight: "ä¾¡å€¤è¦³ãŒã—ã£ã‹ã‚Šå½¢æˆã•ã‚Œã¦ã„ã‚‹" },
            { message: "è¦‹ãˆã¦ããŸ...å‰µé€ æ€§ã®æºæ³‰ãŒæ˜ã‚‰ã‹ã«ãªã‚Šã¤ã¤ã‚ã‚‹", insight: "ç‹¬è‡ªã®è¦–ç‚¹ã‚’æŒã£ã¦ã„ã‚‹" },
            { message: "ç´ æ™´ã‚‰ã—ã„...å›ã®å¼·ã¿ãŒè¼ªéƒ­ã‚’å¸¯ã³ã¦ããŸ", insight: "ã‚³ã‚¢ã‚³ãƒ³ãƒ”ã‚¿ãƒ³ã‚¹ãŒæ˜ç¢º" },
            { message: "æœ€å¾Œã®è©¦ç·´ã ...å›ã®æœ¬è³ªãŒå®Œå…¨ã«å§¿ã‚’ç¾ã™", insight: "è‡ªå·±ç†è§£ã®æ—…ãŒå®Œäº†ã«è¿‘ã¥ã„ã¦ã„ã‚‹" },
            { message: "å…¨ã¦ãŒæ˜ã‚‰ã‹ã«ãªã£ãŸ...å›ã®ã‚«ãƒ¼ãƒ‰ãŒå¬å–šã•ã‚Œã‚‹æ™‚ãŒæ¥ãŸ", insight: "è¨ºæ–­å®Œäº†" }
        ];

        const cardRevealFeedbacks = [
            "å›ã®é­‚ã®æ·±å±¤ã‹ã‚‰ã€å…‰ã¨å½±ã®ã‚«ãƒ¼ãƒ‰ãŒå§¿ã‚’ç¾ã—ãŸ...",
            "ã“ã‚Œã‚‰ã®ã‚«ãƒ¼ãƒ‰ã¯å›ã®å¯èƒ½æ€§ã¨èª²é¡Œã‚’æ˜ ã—å‡ºã—ã¦ã„ã‚‹",
            "å½±ã‚’çŸ¥ã‚‹ã“ã¨ã¯ã€å…‰ã‚’æœ€å¤§é™ã«æ´»ã‹ã™éµã¨ãªã‚‹"
        ];

        // ===== Card Templates =====
        const monsterTemplates = [
            { name: "å…ˆå»¶ã°ã—ã®é­”ç‰©", desc: "é‡è¦ãªã“ã¨ã‚’å¾Œå›ã—ã«ã™ã‚‹", icon: "ğŸ‘»" },
            { name: "å®Œç’§ä¸»ç¾©ã®äº¡éœŠ", desc: "å®Œç’§ã§ãªã„ã¨å‹•ã‘ãªã„", icon: "ğŸ’€" },
            { name: "æ¯”è¼ƒã®æ‚ªé­”", desc: "ä»–äººã¨æ¯”ã¹ã¦è½ã¡è¾¼ã‚€", icon: "ğŸ‘¿" },
            { name: "ä¸å®‰ã®éœ§", desc: "æœªæ¥ã®ä¸å®‰ã«å›šã‚ã‚Œã‚‹", icon: "ğŸŒ«ï¸" },
            { name: "å­¤ç‹¬ã®å½±", desc: "ä¸€äººã§æŠ±ãˆè¾¼ã‚€", icon: "ğŸ‘¤" },
            { name: "éå»ã®æ€¨éœŠ", desc: "éå»ã®å¤±æ•—ã‚’å¼•ããšã‚‹", icon: "ğŸ‘»" }
        ];

        const heroTemplates = [
            { name: "è¡Œå‹•ã®æˆ¦å£«", desc: "ã™ãã«å®Ÿè¡Œã«ç§»ã›ã‚‹", icon: "âš”ï¸" },
            { name: "åˆ†æã®è³¢è€…", desc: "ç‰©äº‹ã‚’æ·±ãè€ƒå¯Ÿã§ãã‚‹", icon: "ğŸ“š" },
            { name: "å…±æ„Ÿã®ç™’ã—æ‰‹", desc: "äººã®æ°—æŒã¡ã‚’ç†è§£ã§ãã‚‹", icon: "ğŸ’š" },
            { name: "å‰µé€ ã®é­”æ³•ä½¿ã„", desc: "æ–°ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ç”Ÿã‚€", icon: "âœ¨" },
            { name: "ç¶™ç¶šã®é¨å£«", desc: "ã‚³ãƒ„ã‚³ãƒ„ç¶šã‘ã‚‰ã‚Œã‚‹", icon: "ğŸ›¡ï¸" },
            { name: "ä¼é”ã®åŸéŠè©©äºº", desc: "è€ƒãˆã‚’ä¸Šæ‰‹ãä¼ãˆã‚‰ã‚Œã‚‹", icon: "ğŸµ" }
        ];

        const skillTemplates = [
            { name: "æ–‡ç« åŠ›", desc: "æ˜ç¢ºã«ä¼ãˆã‚‹åŠ›", icon: "âœï¸" },
            { name: "åˆ†æåŠ›", desc: "ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è§£ãåŠ›", icon: "ğŸ“Š" },
            { name: "ä¼ç”»åŠ›", desc: "æ–°ã—ã„è¨ˆç”»ã‚’ç«‹ã¦ã‚‹åŠ›", icon: "ğŸ’¡" },
            { name: "ç¶™ç¶šåŠ›", desc: "ç¿’æ…£ã‚’ç¶­æŒã™ã‚‹åŠ›", icon: "ğŸ”„" },
            { name: "ç™ºä¿¡åŠ›", desc: "æƒ…å ±ã‚’åºƒã‚ã‚‹åŠ›", icon: "ğŸ“¢" }
        ];

        // ===== Quest Templates =====
        const questTemplates = {
            monster: [
                { title: "å…ˆå»¶ã°ã—è¨ä¼", desc: "ä»Šæ—¥ã‚„ã‚‹ã¹ãã“ã¨ã‚’3ã¤æ›¸ãå‡ºã—ã€1ã¤ã‚’å®Œäº†ã™ã‚‹", difficulty: 1 },
                { title: "å®Œç’§ä¸»ç¾©ã¨ã®å¯¾è©±", desc: "70%ã®å®Œæˆåº¦ã§ä½•ã‹ã‚’å…¬é–‹ã—ã¦ã¿ã‚‹", difficulty: 2 },
                { title: "æ¯”è¼ƒã®ç½ ã‚’é¿ã‘ã‚‹", desc: "è‡ªåˆ†ã®1ãƒ¶æœˆå‰ã¨æ¯”è¼ƒã—ã¦æˆé•·ã‚’è¨˜éŒ²ã™ã‚‹", difficulty: 1 },
                { title: "ä¸å®‰ã®æ­£ä½“ã‚’æš´ã", desc: "ä¸å®‰ãªã“ã¨ã‚’3ã¤æ›¸ãå‡ºã—ã€å¯¾ç­–ã‚’è€ƒãˆã‚‹", difficulty: 2 },
                { title: "åŠ©ã‘ã‚’æ±‚ã‚ã‚‹", desc: "èª°ã‹ã«ç›¸è«‡ã‚„è³ªå•ã‚’ã—ã¦ã¿ã‚‹", difficulty: 2 }
            ],
            hero: [
                { title: "å³è¡Œå‹•ãƒãƒ£ãƒ¬ãƒ³ã‚¸", desc: "æ€ã„ã¤ã„ãŸã“ã¨ã‚’5åˆ†ä»¥å†…ã«å§‹ã‚ã‚‹", difficulty: 1 },
                { title: "æ·±æ˜ã‚Šåˆ†æ", desc: "èˆˆå‘³ã‚ã‚‹ãƒ†ãƒ¼ãƒã«ã¤ã„ã¦30åˆ†èª¿æŸ»ã™ã‚‹", difficulty: 1 },
                { title: "å…±æ„Ÿã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼", desc: "èª°ã‹ã®è©±ã‚’15åˆ†é–“ã˜ã£ãã‚Šèã", difficulty: 2 },
                { title: "ã‚¢ã‚¤ãƒ‡ã‚¢å‰µå‡º", desc: "1ã¤ã®ãƒ†ãƒ¼ãƒã§10å€‹ã®ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’å‡ºã™", difficulty: 2 },
                { title: "ç¶™ç¶šã®å„€å¼", desc: "å°ã•ãªç¿’æ…£ã‚’1é€±é–“ç¶šã‘ã‚‹", difficulty: 3 },
                { title: "ç™ºä¿¡ã®ç¬¬ä¸€æ­©", desc: "å­¦ã‚“ã ã“ã¨ã‚’SNSã§1ã¤ã‚·ã‚§ã‚¢ã™ã‚‹", difficulty: 1 }
            ]
        };

        // ===== Core Functions =====
        function init() {
            loadGameState();
            updateProgress();
            createParticles();
            if (gameState.cycle > 1) {
                // 2å‘¨ç›®ä»¥é™ã¯ã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ
                goToScreen('screen-quests');
            }
        }

        function createParticles() {
            const container = document.getElementById('particles');
            const particleCount = 20;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                container.appendChild(particle);
            }
        }

        function loadGameState() {
            const saved = localStorage.getItem('bunme_state');
            if (saved) {
                gameState = JSON.parse(saved);
            }
        }

        function saveGameState() {
            localStorage.setItem('bunme_state', JSON.stringify(gameState));
        }

        function goToScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            gameState.currentScreen = screenId;
            updateProgress();
            saveGameState();

            // Screen-specific initialization
            if (screenId === 'screen-quiz') {
                startQuiz();
            } else if (screenId === 'screen-quests') {
                renderQuests();
            } else if (screenId === 'screen-records') {
                renderRecords();
                populateQuestSelect();
            } else if (screenId === 'screen-content') {
                populateContentTopics();
            } else if (screenId === 'screen-goal') {
                updateGoalScreen();
            }
        }

        function updateProgress() {
            const screens = ['screen-register', 'screen-quiz', 'screen-cards', 'screen-path', 'screen-quests', 'screen-records', 'screen-content', 'screen-goal'];
            const currentIndex = screens.indexOf(gameState.currentScreen);
            const progress = Math.max(0, (currentIndex / (screens.length - 1)) * 100);
            document.getElementById('progressFill').style.width = progress + '%';

            // Update step indicators
            const stepMap = {
                'screen-register': 1, 'screen-quiz': 1,
                'screen-cards': 2, 'screen-path': 2,
                'screen-quests': 3,
                'screen-records': 4,
                'screen-content': 5, 'screen-goal': 5
            };
            const currentStep = stepMap[gameState.currentScreen] || 1;

            document.querySelectorAll('.progress-step').forEach(step => {
                const stepNum = parseInt(step.dataset.step);
                step.classList.remove('active', 'completed');
                if (stepNum < currentStep) {
                    step.classList.add('completed');
                } else if (stepNum === currentStep) {
                    step.classList.add('active');
                }
            });
        }

        // ===== Registration =====
        function saveRegistration() {
            const name = document.getElementById('userName').value.trim();
            const age = document.getElementById('userAge').value;
            const goal = document.getElementById('userGoal').value.trim();

            if (!name) {
                alert('åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            gameState.user.name = name;
            gameState.user.age = age;
            gameState.user.goal = goal;
            saveGameState();
            goToScreen('screen-quiz');
        }

        // ===== Quiz System (Binary Choice) =====
        let currentQuizIndex = 0;
        let darkScore = 0;
        let heroScore = 0;

        function startQuiz() {
            currentQuizIndex = 0;
            darkScore = 0;
            heroScore = 0;
            gameState.quizAnswers = [];
            document.getElementById('mysticFeedbackContainer').innerHTML = '';
            showBinaryQuestion();
        }

        function showBinaryQuestion() {
            if (currentQuizIndex >= quizQuestions.length) {
                finishQuiz();
                return;
            }

            const q = quizQuestions[currentQuizIndex];
            document.getElementById('quizQuestion').textContent = `ã€Œ${q.question}ã€`;
            document.getElementById('quizProgress').textContent = `${currentQuizIndex + 1} / ${quizQuestions.length}`;

            // Set icons and text for binary choices
            document.getElementById('choiceLeftIcon').textContent = q.leftIcon;
            document.getElementById('choiceRightIcon').textContent = q.rightIcon;
            document.getElementById('choiceLeftText').textContent = q.options[0].text;
            document.getElementById('choiceRightText').textContent = q.options[1].text;

            // Reset card styles
            document.getElementById('choiceLeft').classList.remove('selected', 'swiped-left', 'swiped-right');
            document.getElementById('choiceRight').classList.remove('selected', 'swiped-left', 'swiped-right');
        }

        function selectBinaryChoice(index) {
            const q = quizQuestions[currentQuizIndex];
            const opt = q.options[index];

            darkScore += opt.dark;
            heroScore += opt.hero;
            gameState.quizAnswers.push(index);

            // Visual feedback - swipe animation
            const leftCard = document.getElementById('choiceLeft');
            const rightCard = document.getElementById('choiceRight');

            if (index === 0) {
                leftCard.classList.add('selected');
                rightCard.classList.add('swiped-right');
            } else {
                rightCard.classList.add('selected');
                leftCard.classList.add('swiped-left');
            }

            // Show mystic feedback
            showMysticFeedback(currentQuizIndex);

            setTimeout(() => {
                currentQuizIndex++;
                showBinaryQuestion();
            }, 1500);
        }

        function showMysticFeedback(index) {
            const feedback = mysticFeedbacks[index];
            const container = document.getElementById('mysticFeedbackContainer');

            container.innerHTML = `
                <div class="mystic-feedback">
                    <p>ã€Œ${feedback.message}ã€</p>
                    <div class="insight">${feedback.insight}</div>
                </div>
            `;
        }

        function finishQuiz() {
            generateCards();
            goToScreen('screen-cards');
        }

        // ===== Card Generation =====
        function generateCards() {
            // Generate dark cards based on score
            const numDark = Math.min(3, Math.ceil(darkScore / 5));
            gameState.monsterCards = [];
            for (let i = 0; i < numDark; i++) {
                const template = monsterTemplates[i % monsterTemplates.length];
                gameState.monsterCards.push({
                    id: 'dark_' + i,
                    ...template,
                    level: 1
                });
            }

            // Generate hero cards based on score
            const numHeroes = Math.min(3, Math.ceil(heroScore / 5));
            gameState.heroCards = [];
            for (let i = 0; i < numHeroes; i++) {
                const template = heroTemplates[i % heroTemplates.length];
                gameState.heroCards.push({
                    id: 'hero_' + i,
                    ...template,
                    level: 1
                });
            }

            renderCards();
            showCardRevealFeedback();
            generateQuests();
            saveGameState();
        }

        function showCardRevealFeedback() {
            const container = document.getElementById('cardRevealFeedback');
            const randomFeedback = cardRevealFeedbacks[Math.floor(Math.random() * cardRevealFeedbacks.length)];

            container.innerHTML = `
                <div class="mystic-feedback">
                    <p>ã€Œ${randomFeedback}ã€</p>
                </div>
            `;
        }

        function renderCards() {
            const monsterContainer = document.getElementById('monsterCards');
            const heroContainer = document.getElementById('heroCards');

            // Render Dark Cards (Tarot style)
            monsterContainer.innerHTML = gameState.monsterCards.map(card => `
                <div class="tarot-card monster-type">
                    <div class="card-icon">${card.icon}</div>
                    <div class="card-name">${card.name}</div>
                    <div class="card-desc">${card.desc}</div>
                </div>
            `).join('');

            // Render Hero Cards (Tarot style)
            heroContainer.innerHTML = gameState.heroCards.map(card => `
                <div class="tarot-card hero-type">
                    <div class="card-icon">${card.icon}</div>
                    <div class="card-name">${card.name}</div>
                    <div class="card-desc">${card.desc}</div>
                </div>
            `).join('');
        }

        // ===== Path Selection =====
        function selectPath(path) {
            gameState.user.path = path;

            document.querySelectorAll('.path-option').forEach(p => p.classList.remove('selected'));
            document.getElementById('path-' + path).classList.add('selected');

            if (path === 'defined') {
                document.getElementById('definedPathInput').classList.remove('hidden');
            } else {
                document.getElementById('definedPathInput').classList.add('hidden');
            }

            document.getElementById('pathNextBtn').disabled = false;
        }

        function confirmPath() {
            if (gameState.user.path === 'defined') {
                gameState.user.activity = document.getElementById('userActivity').value.trim();
            }
            saveGameState();
            goToScreen('screen-quests');
        }

        // ===== Quest System =====
        function generateQuests() {
            gameState.quests = [];

            // Monster quests
            questTemplates.monster.forEach((q, i) => {
                gameState.quests.push({
                    id: 'quest_m_' + i,
                    type: 'monster',
                    ...q,
                    completed: false,
                    note: ''
                });
            });

            // Hero quests
            questTemplates.hero.forEach((q, i) => {
                gameState.quests.push({
                    id: 'quest_h_' + i,
                    type: 'hero',
                    ...q,
                    completed: false,
                    note: ''
                });
            });

            // Add activity-specific quests if path is defined
            if (gameState.user.path === 'defined' && gameState.user.activity) {
                gameState.quests.push({
                    id: 'quest_custom_1',
                    type: 'hero',
                    title: 'æ´»å‹•ã‚’1æ™‚é–“å®Ÿè·µ',
                    desc: `ã€Œ${gameState.user.activity}ã€ã«1æ™‚é–“å–ã‚Šçµ„ã‚€`,
                    difficulty: 2,
                    completed: false,
                    note: ''
                });
            }

            saveGameState();
        }

        function renderQuests() {
            const questList = document.getElementById('questList');
            const filteredQuests = gameState.quests.filter(q => q.type === gameState.currentQuestTab);

            questList.innerHTML = filteredQuests.map(quest => `
                <div class="quest-item ${quest.completed ? 'completed' : ''}" onclick="openQuestModal('${quest.id}')">
                    <div class="quest-icon ${quest.type}">${quest.type === 'monster' ? 'ğŸ‘¹' : 'âš”ï¸'}</div>
                    <div class="quest-info">
                        <div class="quest-title">${quest.title}</div>
                        <div class="quest-desc">${quest.desc}</div>
                    </div>
                    <span class="quest-status ${quest.completed ? 'status-completed' : 'status-pending'}">
                        ${quest.completed ? 'å®Œäº†' : 'æœªå®Œäº†'}
                    </span>
                </div>
            `).join('');

            // Update stats
            const completed = gameState.quests.filter(q => q.completed).length;
            document.getElementById('completedQuests').textContent = completed;
            document.getElementById('totalRecords').textContent = gameState.records.length;
        }

        function switchQuestTab(tab) {
            gameState.currentQuestTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            renderQuests();
        }

        function openQuestModal(questId) {
            const quest = gameState.quests.find(q => q.id === questId);
            if (!quest) return;

            gameState.selectedQuest = questId;
            document.getElementById('modalQuestTitle').textContent = quest.title;
            document.getElementById('modalQuestDesc').textContent = quest.desc;
            document.getElementById('questNote').value = quest.note || '';
            document.getElementById('questModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('questModal').classList.remove('active');
            gameState.selectedQuest = null;
        }

        function completeQuest() {
            if (!gameState.selectedQuest) return;

            const quest = gameState.quests.find(q => q.id === gameState.selectedQuest);
            if (quest) {
                quest.completed = true;
                quest.note = document.getElementById('questNote').value;

                // Check for skill acquisition
                checkSkillAcquisition();
            }

            saveGameState();
            closeModal();
            renderQuests();
        }

        function checkSkillAcquisition() {
            const completedCount = gameState.quests.filter(q => q.completed).length;

            // Award skill every 3 completed quests
            if (completedCount > 0 && completedCount % 3 === 0) {
                const skillIndex = Math.floor(completedCount / 3) - 1;
                if (skillIndex < skillTemplates.length && !gameState.skillCards.find(s => s.id === 'skill_' + skillIndex)) {
                    const template = skillTemplates[skillIndex];
                    gameState.skillCards.push({
                        id: 'skill_' + skillIndex,
                        ...template,
                        level: 1,
                        acquiredAt: new Date().toISOString()
                    });
                    alert(`æ–°ã—ã„ã‚¹ã‚­ãƒ«ã€Œ${template.name}ã€ã‚’ç²å¾—ã—ã¾ã—ãŸï¼`);
                }
            }
        }

        // ===== Activity Records =====
        function populateQuestSelect() {
            const select = document.getElementById('recordQuest');
            select.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>';

            gameState.quests.forEach(quest => {
                const option = document.createElement('option');
                option.value = quest.id;
                option.textContent = quest.title;
                select.appendChild(option);
            });
        }

        function saveRecord() {
            const title = document.getElementById('recordTitle').value.trim();
            const content = document.getElementById('recordContent').value.trim();
            const questId = document.getElementById('recordQuest').value;

            if (!title || !content) {
                alert('ã‚¿ã‚¤ãƒˆãƒ«ã¨è©³ç´°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            gameState.records.push({
                id: 'record_' + Date.now(),
                title,
                content,
                questId,
                createdAt: new Date().toISOString()
            });

            // Clear form
            document.getElementById('recordTitle').value = '';
            document.getElementById('recordContent').value = '';
            document.getElementById('recordQuest').value = '';

            saveGameState();
            renderRecords();

            // Update stats
            document.getElementById('totalRecords').textContent = gameState.records.length;
        }

        function renderRecords() {
            const log = document.getElementById('activityLog');

            if (gameState.records.length === 0) {
                log.innerHTML = '<p style="color: var(--text-muted); text-align: center;">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }

            log.innerHTML = gameState.records.slice().reverse().map(record => {
                const date = new Date(record.createdAt).toLocaleDateString('ja-JP');
                return `
                    <div class="activity-entry">
                        <strong>${record.title}</strong>
                        <p>${record.content.substring(0, 100)}${record.content.length > 100 ? '...' : ''}</p>
                        <div class="activity-date">${date}</div>
                    </div>
                `;
            }).join('');
        }

        // ===== Content Generation =====
        let currentContentType = 'blog';

        function selectContentType(type) {
            currentContentType = type;
            document.querySelectorAll('.content-type-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.toLowerCase().includes(type) ||
                    (type === 'sns' && btn.textContent === 'SNSæŠ•ç¨¿') ||
                    (type === 'newsletter' && btn.textContent === 'ãƒ¡ãƒ«ãƒã‚¬')) {
                    btn.classList.add('active');
                }
            });
        }

        function populateContentTopics() {
            const select = document.getElementById('contentTopic');
            select.innerHTML = '<option value="">æ´»å‹•è¨˜éŒ²ã‹ã‚‰é¸æŠ</option>';

            gameState.records.forEach(record => {
                const option = document.createElement('option');
                option.value = record.id;
                option.textContent = record.title;
                select.appendChild(option);
            });
        }

        function generateContent() {
            const topicId = document.getElementById('contentTopic').value;
            const record = gameState.records.find(r => r.id === topicId);

            if (!record) {
                alert('è¨˜éŒ²ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            let content = '';
            const userName = gameState.user.name;

            switch (currentContentType) {
                case 'blog':
                    content = generateBlogContent(record, userName);
                    break;
                case 'sns':
                    content = generateSNSContent(record, userName);
                    break;
                case 'newsletter':
                    content = generateNewsletterContent(record, userName);
                    break;
            }

            document.getElementById('contentOutput').innerHTML = `<pre style="white-space: pre-wrap;">${content}</pre>`;

            gameState.generatedContents.push({
                id: 'content_' + Date.now(),
                type: currentContentType,
                content,
                recordId: topicId,
                createdAt: new Date().toISOString()
            });

            saveGameState();
        }

        function generateBlogContent(record, userName) {
            return `ã€${record.title}ã€‘

${userName}ã§ã™ã€‚

ä»Šæ—¥ã¯ã€Œ${record.title}ã€ã«ã¤ã„ã¦æ›¸ãã¾ã™ã€‚

${record.content}

ã“ã®çµŒé¨“ã‹ã‚‰å­¦ã‚“ã ã“ã¨ã¯ã€
ãƒ»å®Ÿè·µã™ã‚‹ã“ã¨ã®å¤§åˆ‡ã•
ãƒ»æŒ¯ã‚Šè¿”ã‚Šã®é‡è¦æ€§
ãƒ»å°ã•ãªä¸€æ­©ã‚’ç©ã¿é‡ã­ã‚‹ã“ã¨

ã§ã™ã€‚

çš†ã•ã‚“ã‚‚ä½•ã‹æ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã—ã¦ã¿ã¦ã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ï¼Ÿ

æœ€å¾Œã¾ã§èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚`;
        }

        function generateSNSContent(record, userName) {
            return `ã€${record.title}ã€‘ã«æŒ‘æˆ¦ã—ã¾ã—ãŸï¼

${record.content.substring(0, 100)}...

å°ã•ãªä¸€æ­©ã§ã‚‚å‰ã«é€²ã‚€ã“ã¨ãŒå¤§åˆ‡ã ã¨å®Ÿæ„Ÿã—ã¾ã—ãŸã€‚

#æŒ‘æˆ¦ #æˆé•· #BUNME`;
        }

        function generateNewsletterContent(record, userName) {
            return `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${userName}ã®æˆé•·æ—¥è¨˜
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â–  ä»Šå›ã®ãƒ†ãƒ¼ãƒ
${record.title}

â–  æœ¬æ–‡
${record.content}

â–  æ°—ã¥ãã¨å­¦ã³
ã“ã®æ´»å‹•ã‚’é€šã˜ã¦ã€è‡ªå·±ç†è§£ãŒæ·±ã¾ã‚Šã¾ã—ãŸã€‚
æ¬¡ã¯æ›´ã«ã‚¹ãƒ†ãƒƒãƒ—ã‚¢ãƒƒãƒ—ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ¬¡å›ã‚‚ãŠæ¥½ã—ã¿ã«ï¼`;
        }

        // ===== Goal Screen =====
        function updateGoalScreen() {
            document.getElementById('goalName').textContent = gameState.user.name || 'å†’é™ºè€…';

            // Set title based on progress
            const completed = gameState.quests.filter(q => q.completed).length;
            let title = 'è¦‹ç¿’ã„å†’é™ºè€…';
            if (completed >= 10) title = 'ç†Ÿç·´ã®æ¢æ±‚è€…';
            else if (completed >= 5) title = 'æˆé•·ã™ã‚‹å†’é™ºè€…';
            else if (completed >= 3) title = 'é§†ã‘å‡ºã—ã®å†’é™ºè€…';
            document.getElementById('goalTitle').textContent = title;

            // Update stats
            document.getElementById('finalQuests').textContent = completed;
            document.getElementById('finalRecords').textContent = gameState.records.length;
            document.getElementById('finalContents').textContent = gameState.generatedContents.length;
            document.getElementById('finalSkills').textContent = gameState.skillCards.length;

            // Render skill cards (Tarot style)
            const skillContainer = document.getElementById('skillCards');
            if (gameState.skillCards.length === 0) {
                skillContainer.innerHTML = '<p style="color: var(--text-muted);">ã¾ã ã‚¹ã‚­ãƒ«ã‚’ç²å¾—ã—ã¦ã„ã¾ã›ã‚“</p>';
            } else {
                skillContainer.innerHTML = gameState.skillCards.map(card => `
                    <div class="tarot-card skill-type">
                        <div class="card-icon">${card.icon}</div>
                        <div class="card-name">${card.name}</div>
                        <div class="card-desc">${card.desc}</div>
                    </div>
                `).join('');
            }
        }

        function startNewCycle() {
            if (!confirm('2å‘¨ç›®ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿé€²æ—ã¯ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ãŒã€ã‚¹ã‚­ãƒ«ã‚«ãƒ¼ãƒ‰ã¯å¼•ãç¶™ãŒã‚Œã¾ã™ã€‚')) {
                return;
            }

            // Keep skills, reset progress
            const skills = gameState.skillCards;
            const user = gameState.user;
            const cycle = gameState.cycle + 1;

            gameState = {
                currentScreen: 'screen-quests',
                user: user,
                quizAnswers: [],
                monsterCards: gameState.monsterCards,
                heroCards: gameState.heroCards,
                skillCards: skills,
                quests: [],
                records: [],
                generatedContents: [],
                cycle: cycle,
                currentQuestTab: 'monster',
                selectedQuest: null
            };

            // Generate new quests for new cycle
            generateQuests();
            saveGameState();
            goToScreen('screen-quests');

            alert(`${cycle}å‘¨ç›®ã‚’é–‹å§‹ã—ã¾ã—ãŸï¼`);
        }

        function exportData() {
            const data = JSON.stringify(gameState, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bunme_data_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ===== Initialize =====
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
