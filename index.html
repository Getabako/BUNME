<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BUNME - åˆ†èº«è‚²æˆã‚²ãƒ¼ãƒ </title>
    <style>
        /* ===== CSS Variables ===== */
        :root {
            --primary-color: #6b46c1;
            --secondary-color: #d69e2e;
            --dark-bg: #1a1a2e;
            --darker-bg: #16213e;
            --card-bg: #0f3460;
            --monster-color: #9b2c2c;
            --hero-color: #2b6cb0;
            --text-light: #e2e8f0;
            --text-muted: #a0aec0;
            --success-color: #48bb78;
            --warning-color: #ed8936;
        }

        /* ===== Reset & Base ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            background: linear-gradient(135deg, var(--dark-bg) 0%, var(--darker-bg) 100%);
            color: var(--text-light);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* ===== Layout ===== */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== Header ===== */
        .header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 2px solid var(--primary-color);
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: var(--text-muted);
            margin-top: 10px;
        }

        /* ===== Progress Bar ===== */
        .progress-container {
            background: var(--darker-bg);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .progress-step {
            font-size: 0.8em;
            color: var(--text-muted);
            text-align: center;
            flex: 1;
        }

        .progress-step.active {
            color: var(--secondary-color);
            font-weight: bold;
        }

        .progress-step.completed {
            color: var(--success-color);
        }

        .progress-bar {
            height: 8px;
            background: var(--card-bg);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 0.5s ease;
        }

        /* ===== Buttons ===== */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), #805ad5);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(107, 70, 193, 0.4);
        }

        .btn-secondary {
            background: var(--card-bg);
            color: var(--text-light);
            border: 2px solid var(--primary-color);
        }

        .btn-secondary:hover {
            background: var(--primary-color);
        }

        .btn-monster {
            background: linear-gradient(135deg, var(--monster-color), #c53030);
            color: white;
        }

        .btn-hero {
            background: linear-gradient(135deg, var(--hero-color), #3182ce);
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ===== Forms ===== */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--text-light);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--card-bg);
            border-radius: 8px;
            background: var(--darker-bg);
            color: var(--text-light);
            font-size: 1em;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* ===== Cards ===== */
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: var(--primary-color);
            transform: translateY(-3px);
        }

        .card-monster {
            border-left: 4px solid var(--monster-color);
        }

        .card-hero {
            border-left: 4px solid var(--hero-color);
        }

        .card-skill {
            border-left: 4px solid var(--success-color);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 1.2em;
            font-weight: bold;
        }

        .card-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .badge-monster {
            background: var(--monster-color);
        }

        .badge-hero {
            background: var(--hero-color);
        }

        .badge-skill {
            background: var(--success-color);
        }

        /* ===== Character Card Display ===== */
        .character-card {
            background: linear-gradient(135deg, var(--darker-bg), var(--card-bg));
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            border: 3px solid var(--secondary-color);
            position: relative;
            overflow: hidden;
        }

        .character-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(107, 70, 193, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .character-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            position: relative;
            z-index: 1;
        }

        .character-name {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .character-title {
            color: var(--secondary-color);
            font-size: 1em;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        /* ===== Quiz Options ===== */
        .quiz-options {
            display: grid;
            gap: 10px;
        }

        .quiz-option {
            padding: 15px 20px;
            background: var(--card-bg);
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .quiz-option:hover {
            border-color: var(--primary-color);
            background: var(--darker-bg);
        }

        .quiz-option.selected {
            border-color: var(--secondary-color);
            background: rgba(214, 158, 46, 0.2);
        }

        /* ===== Card Grid ===== */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .mini-card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .mini-card:hover {
            transform: scale(1.05);
        }

        .mini-card.selected {
            border-color: var(--secondary-color);
            box-shadow: 0 0 20px rgba(214, 158, 46, 0.3);
        }

        .mini-card-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .mini-card-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .mini-card-desc {
            font-size: 0.8em;
            color: var(--text-muted);
        }

        /* ===== Quest List ===== */
        .quest-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quest-item:hover {
            background: var(--darker-bg);
        }

        .quest-item.completed {
            opacity: 0.6;
        }

        .quest-icon {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            margin-right: 15px;
        }

        .quest-icon.monster {
            background: var(--monster-color);
        }

        .quest-icon.hero {
            background: var(--hero-color);
        }

        .quest-info {
            flex: 1;
        }

        .quest-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .quest-desc {
            font-size: 0.9em;
            color: var(--text-muted);
        }

        .quest-status {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8em;
        }

        .status-pending {
            background: var(--warning-color);
        }

        .status-completed {
            background: var(--success-color);
        }

        /* ===== Activity Log ===== */
        .activity-log {
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: var(--darker-bg);
            border-radius: 8px;
        }

        .activity-entry {
            padding: 10px;
            border-bottom: 1px solid var(--card-bg);
            font-size: 0.9em;
        }

        .activity-entry:last-child {
            border-bottom: none;
        }

        .activity-date {
            color: var(--text-muted);
            font-size: 0.8em;
        }

        /* ===== Stats Display ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .stat-box {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: var(--secondary-color);
        }

        .stat-label {
            font-size: 0.9em;
            color: var(--text-muted);
        }

        /* ===== Path Selection ===== */
        .path-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .path-option {
            padding: 30px 20px;
            background: var(--card-bg);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .path-option:hover {
            border-color: var(--primary-color);
            transform: translateY(-5px);
        }

        .path-option.selected {
            border-color: var(--secondary-color);
        }

        .path-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .path-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .path-desc {
            font-size: 0.9em;
            color: var(--text-muted);
        }

        /* ===== Content Generator ===== */
        .content-output {
            background: var(--darker-bg);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid var(--secondary-color);
        }

        .content-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .content-type-btn {
            padding: 8px 16px;
            border-radius: 20px;
            background: var(--card-bg);
            color: var(--text-light);
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .content-type-btn.active {
            background: var(--primary-color);
        }

        /* ===== Deck Display ===== */
        .deck-container {
            background: var(--darker-bg);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .deck-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .deck-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .deck-card {
            padding: 8px 12px;
            background: var(--card-bg);
            border-radius: 6px;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* ===== Navigation ===== */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--card-bg);
        }

        /* ===== Modal ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--darker-bg);
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.5em;
            cursor: pointer;
        }

        /* ===== Tabs ===== */
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--card-bg);
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.3s ease;
        }

        .tab.active {
            border-bottom-color: var(--primary-color);
            color: var(--secondary-color);
        }

        /* ===== Responsive ===== */
        @media (max-width: 600px) {
            .path-selection {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .card-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }
        }

        /* ===== Utility ===== */
        .text-center {
            text-align: center;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>BUNME</h1>
            <p>è‡ªå·±ç†è§£ã‚’ã‚«ãƒ¼ãƒ‰ãƒãƒˆãƒ«ã«å¤‰ãˆã‚‹åˆ†èº«è‚²æˆã‚²ãƒ¼ãƒ </p>
        </header>

        <!-- Progress Bar -->
        <div class="progress-container" id="progressContainer">
            <div class="progress-steps">
                <span class="progress-step" data-step="1">è¨ºæ–­</span>
                <span class="progress-step" data-step="2">ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ</span>
                <span class="progress-step" data-step="3">ã‚¯ã‚¨ã‚¹ãƒˆ</span>
                <span class="progress-step" data-step="4">è¨˜éŒ²</span>
                <span class="progress-step" data-step="5">ç™ºä¿¡</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
        </div>

        <!-- Screen 1: Welcome -->
        <div class="screen active" id="screen-welcome">
            <div class="character-card">
                <div class="character-avatar">ğŸ®</div>
                <h2 class="character-name">BUNMEã¸ã‚ˆã†ã“ã</h2>
                <p class="character-title">60æ—¥é–“ã®å†’é™ºãŒå§‹ã¾ã‚Šã¾ã™</p>
            </div>
            <div class="card mt-20">
                <h3>BUNMEã¨ã¯ï¼Ÿ</h3>
                <p class="mt-20">éŠã³ãªãŒã‚‰ã€è‡ªåˆ†ã¨ãƒ“ã‚¸ãƒã‚¹ã¨AIã‚’è‚²ã¦ã‚‹å†’é™ºã§ã™ã€‚</p>
                <ul style="margin: 15px 0 15px 20px;">
                    <li>é™°ï¼ˆãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ï¼‰ï¼šè‹¦æ‰‹ãƒ»èª²é¡Œãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å¯è¦–åŒ–</li>
                    <li>é™½ï¼ˆãƒ’ãƒ¼ãƒ­ãƒ¼ï¼‰ï¼šå¾—æ„ãƒ»å¼·ã¿è³‡è³ªã‚’å¯è¦–åŒ–</li>
                    <li>ã‚¯ã‚¨ã‚¹ãƒˆã‚’é€šã˜ã¦æˆé•·ã‚’è¨˜éŒ²</li>
                    <li>æ´»å‹•ã‚’ç™ºä¿¡ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«å¤‰æ›</li>
                </ul>
            </div>
            <div class="text-center mt-20">
                <button class="btn btn-primary" onclick="goToScreen('screen-register')">å†’é™ºã‚’å§‹ã‚ã‚‹</button>
            </div>
        </div>

        <!-- Screen 2: Registration -->
        <div class="screen" id="screen-register">
            <h2 class="mb-20">STEP 1: è¨ºæ–­ã®æ´çªŸ</h2>
            <p class="mb-20" style="color: var(--text-muted);">ã¾ãšã¯åŸºæœ¬æƒ…å ±ã‚’ç™»éŒ²ã—ã¦ã€ã‚ãªãŸã®åˆ†èº«ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚</p>

            <div class="form-group">
                <label for="userName">å†’é™ºè€…ã®åå‰</label>
                <input type="text" id="userName" placeholder="ã‚ãªãŸã®åå‰ã‚’å…¥åŠ›">
            </div>

            <div class="form-group">
                <label for="userAge">å¹´é½¢</label>
                <select id="userAge">
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value="10s">10ä»£</option>
                    <option value="20s">20ä»£</option>
                    <option value="30s">30ä»£</option>
                    <option value="40s">40ä»£</option>
                    <option value="50s">50ä»£ä»¥ä¸Š</option>
                </select>
            </div>

            <div class="form-group">
                <label for="userGoal">ç¾åœ¨ã®ç›®æ¨™ã‚„èˆˆå‘³ï¼ˆä»»æ„ï¼‰</label>
                <textarea id="userGoal" placeholder="ä»Šå–ã‚Šçµ„ã‚“ã§ã„ã‚‹ã“ã¨ã‚„èˆˆå‘³ãŒã‚ã‚‹ã“ã¨ã‚’è‡ªç”±ã«æ›¸ã„ã¦ãã ã•ã„"></textarea>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToScreen('screen-welcome')">æˆ»ã‚‹</button>
                <button class="btn btn-primary" onclick="saveRegistration()">æ¬¡ã¸</button>
            </div>
        </div>

        <!-- Screen 3: Quiz -->
        <div class="screen" id="screen-quiz">
            <h2 class="mb-20">æœ¬æ ¼ã‚¯ã‚¤ã‚ºãƒ•ãƒ­ãƒ¼è¨ºæ–­</h2>
            <p class="mb-20" style="color: var(--text-muted);">è³ªå•ã«ç­”ãˆã¦ã€ã‚ãªãŸã®ç‰¹æ€§ã‚’è¨ºæ–­ã—ã¾ã™ã€‚</p>

            <div id="quizContainer">
                <div class="card">
                    <p id="quizQuestion" style="font-size: 1.1em; margin-bottom: 20px;"></p>
                    <div class="quiz-options" id="quizOptions"></div>
                </div>
                <div class="text-center mt-20">
                    <span id="quizProgress">1 / 10</span>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToScreen('screen-register')">æˆ»ã‚‹</button>
            </div>
        </div>

        <!-- Screen 4: Card Generation -->
        <div class="screen" id="screen-cards">
            <h2 class="mb-20">STEP 2: ã‚«ãƒ¼ãƒ‰å¬å–šã®ç¥­å£‡</h2>
            <p class="mb-20" style="color: var(--text-muted);">è¨ºæ–­çµæœã‹ã‚‰ã‚ãªãŸã®ã‚«ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸï¼</p>

            <div class="deck-container">
                <div class="deck-title">
                    <span style="color: var(--monster-color);">ğŸ‘¹</span>
                    ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚«ãƒ¼ãƒ‰ï¼ˆèª²é¡Œãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
                </div>
                <div class="card-grid" id="monsterCards"></div>
            </div>

            <div class="deck-container">
                <div class="deck-title">
                    <span style="color: var(--hero-color);">âš”ï¸</span>
                    ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚«ãƒ¼ãƒ‰ï¼ˆå¼·ã¿è³‡è³ªï¼‰
                </div>
                <div class="card-grid" id="heroCards"></div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToScreen('screen-quiz')">æˆ»ã‚‹</button>
                <button class="btn btn-primary" onclick="goToScreen('screen-path')">æ¬¡ã¸</button>
            </div>
        </div>

        <!-- Screen 5: Path Selection -->
        <div class="screen" id="screen-path">
            <h2 class="mb-20">å†’é™ºã®é“ã‚’é¸æŠ</h2>
            <p class="mb-20" style="color: var(--text-muted);">ã‚ãªãŸã®ç¾åœ¨ã®çŠ¶æ³ã«åˆã‚ã›ã¦é“ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>

            <div class="path-selection">
                <div class="path-option" onclick="selectPath('defined')" id="path-defined">
                    <div class="path-icon">ğŸ¯</div>
                    <div class="path-title">ã‚„ã‚ŠãŸã„ã“ã¨ãŒæ±ºã¾ã£ã¦ã„ã‚‹</div>
                    <div class="path-desc">ç›®æ¨™ã«å‘ã‹ã£ã¦ã‚¯ã‚¨ã‚¹ãƒˆã«æŒ‘æˆ¦ã—ã€èª²é¡Œã‚’å…‹æœã—ã¦ã„ã</div>
                </div>
                <div class="path-option" onclick="selectPath('exploring')" id="path-exploring">
                    <div class="path-icon">ğŸ”</div>
                    <div class="path-title">ã¾ã æ¢ã—ã¦ã„ã‚‹</div>
                    <div class="path-desc">è¶£å‘³å—œå¥½ã«åˆã£ãŸæ´»å‹•ã‚’ææ¡ˆã•ã‚Œã€æ–°ã—ã„ç™ºè¦‹ã‚’ã™ã‚‹</div>
                </div>
            </div>

            <div id="definedPathInput" class="hidden">
                <div class="form-group">
                    <label for="userActivity">ã‚„ã‚ŠãŸã„ã“ã¨ãƒ»å–ã‚Šçµ„ã‚“ã§ã„ã‚‹æ´»å‹•</label>
                    <textarea id="userActivity" placeholder="å…·ä½“çš„ã«æ•™ãˆã¦ãã ã•ã„ï¼ˆä¾‹ï¼šãƒ–ãƒ­ã‚°ã§æƒ…å ±ç™ºä¿¡ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å­¦ç¿’ã€å‰¯æ¥­ã®ç«‹ã¡ä¸Šã’ ãªã©ï¼‰"></textarea>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToScreen('screen-cards')">æˆ»ã‚‹</button>
                <button class="btn btn-primary" onclick="confirmPath()" id="pathNextBtn" disabled>æ¬¡ã¸</button>
            </div>
        </div>

        <!-- Screen 6: Quest Dashboard -->
        <div class="screen" id="screen-quests">
            <h2 class="mb-20">ã‚¯ã‚¨ã‚¹ãƒˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-value" id="completedQuests">0</div>
                    <div class="stat-label">å®Œäº†ã‚¯ã‚¨ã‚¹ãƒˆ</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="totalRecords">0</div>
                    <div class="stat-label">æ´»å‹•è¨˜éŒ²æ•°</div>
                </div>
            </div>

            <div class="tabs">
                <div class="tab active" onclick="switchQuestTab('monster')">ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼è¨ä¼</div>
                <div class="tab" onclick="switchQuestTab('hero')">ãƒ’ãƒ¼ãƒ­ãƒ¼è‚²æˆ</div>
            </div>

            <div id="questList"></div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToScreen('screen-path')">æˆ»ã‚‹</button>
                <button class="btn btn-primary" onclick="goToScreen('screen-records')">æ´»å‹•è¨˜éŒ²ã¸</button>
            </div>
        </div>

        <!-- Screen 7: Activity Records -->
        <div class="screen" id="screen-records">
            <h2 class="mb-20">STEP 3: è¨˜éŒ²ã®éŒ¬é‡‘è¡“</h2>
            <p class="mb-20" style="color: var(--text-muted);">æ´»å‹•ã‚’è¨˜éŒ²ã—ã¦ã€ã‚ãªãŸã®æ–‡ä½“ã‚’åé›†ã—ã¾ã™ã€‚</p>

            <div class="card">
                <h3 class="mb-20">æ–°ã—ã„æ´»å‹•ã‚’è¨˜éŒ²</h3>
                <div class="form-group">
                    <label for="recordTitle">æ´»å‹•ã‚¿ã‚¤ãƒˆãƒ«</label>
                    <input type="text" id="recordTitle" placeholder="ä½•ã‚’ã—ã¾ã—ãŸã‹ï¼Ÿ">
                </div>
                <div class="form-group">
                    <label for="recordContent">è©³ç´°ãƒ»æ„Ÿæƒ³</label>
                    <textarea id="recordContent" placeholder="ã©ã‚“ãªã“ã¨ã‚’ã—ã¦ã€ã©ã†æ„Ÿã˜ã¾ã—ãŸã‹ï¼Ÿè‡ªç”±ã«æ›¸ã„ã¦ãã ã•ã„ã€‚"></textarea>
                </div>
                <div class="form-group">
                    <label for="recordQuest">é–¢é€£ã‚¯ã‚¨ã‚¹ãƒˆ</label>
                    <select id="recordQuest">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="saveRecord()">è¨˜éŒ²ã‚’ä¿å­˜</button>
            </div>

            <h3 class="mt-20 mb-20">æ´»å‹•å±¥æ­´</h3>
            <div class="activity-log" id="activityLog">
                <p style="color: var(--text-muted); text-align: center;">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToScreen('screen-quests')">æˆ»ã‚‹</button>
                <button class="btn btn-primary" onclick="goToScreen('screen-content')">ç™ºä¿¡ã¸</button>
            </div>
        </div>

        <!-- Screen 8: Content Generation -->
        <div class="screen" id="screen-content">
            <h2 class="mb-20">ç™ºä¿¡ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆ</h2>
            <p class="mb-20" style="color: var(--text-muted);">ã‚ãªãŸã®æ´»å‹•è¨˜éŒ²ã‹ã‚‰ç™ºä¿¡ç”¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆã—ã¾ã™ã€‚</p>

            <div class="content-type-selector">
                <button class="content-type-btn active" onclick="selectContentType('blog')">ãƒ–ãƒ­ã‚°</button>
                <button class="content-type-btn" onclick="selectContentType('sns')">SNSæŠ•ç¨¿</button>
                <button class="content-type-btn" onclick="selectContentType('newsletter')">ãƒ¡ãƒ«ãƒã‚¬</button>
            </div>

            <div class="form-group">
                <label for="contentTopic">ãƒ†ãƒ¼ãƒã‚’é¸æŠ</label>
                <select id="contentTopic">
                    <option value="">æ´»å‹•è¨˜éŒ²ã‹ã‚‰é¸æŠ</option>
                </select>
            </div>

            <button class="btn btn-primary mb-20" onclick="generateContent()">ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆ</button>

            <div class="content-output" id="contentOutput">
                <p style="color: var(--text-muted);">ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToScreen('screen-records')">æˆ»ã‚‹</button>
                <button class="btn btn-primary" onclick="goToScreen('screen-goal')">ã‚´ãƒ¼ãƒ«ã¸</button>
            </div>
        </div>

        <!-- Screen 9: Goal & Review -->
        <div class="screen" id="screen-goal">
            <h2 class="mb-20">GOAL: æŒ¯ã‚Šè¿”ã‚Šï¼†æœªæ¥ã¸</h2>

            <div class="character-card">
                <div class="character-avatar" id="goalAvatar">ğŸ†</div>
                <h2 class="character-name" id="goalName">å†’é™ºè€…</h2>
                <p class="character-title" id="goalTitle">æˆé•·ã™ã‚‹æ¢æ±‚è€…</p>
            </div>

            <div class="stats-grid mt-20">
                <div class="stat-box">
                    <div class="stat-value" id="finalQuests">0</div>
                    <div class="stat-label">ã‚¯ã‚¨ã‚¹ãƒˆå®Œäº†</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="finalRecords">0</div>
                    <div class="stat-label">æ´»å‹•è¨˜éŒ²</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="finalContents">0</div>
                    <div class="stat-label">ç”Ÿæˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="finalSkills">0</div>
                    <div class="stat-label">ç²å¾—ã‚¹ã‚­ãƒ«</div>
                </div>
            </div>

            <div class="deck-container">
                <div class="deck-title">
                    <span style="color: var(--success-color);">â­</span>
                    ç²å¾—ã‚¹ã‚­ãƒ«ã‚«ãƒ¼ãƒ‰
                </div>
                <div class="card-grid" id="skillCards"></div>
            </div>

            <div class="card mt-20">
                <h3 class="mb-20">æ¬¡ã®å‘¨å›ã¸</h3>
                <p style="color: var(--text-muted);">ä»Šå›ã®å†’é™ºã§å¾—ãŸçµŒé¨“ã‚’æ´»ã‹ã—ã¦ã€ã•ã‚‰ãªã‚‹æˆé•·ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ï¼</p>
                <button class="btn btn-primary mt-20" onclick="startNewCycle()">2å‘¨ç›®ã‚’é–‹å§‹</button>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToScreen('screen-content')">æˆ»ã‚‹</button>
                <button class="btn btn-secondary" onclick="exportData()">ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
            </div>
        </div>

        <!-- Quest Modal -->
        <div class="modal" id="questModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalQuestTitle">ã‚¯ã‚¨ã‚¹ãƒˆè©³ç´°</h3>
                    <button class="modal-close" onclick="closeModal()">&times;</button>
                </div>
                <p id="modalQuestDesc" class="mb-20"></p>
                <div class="form-group">
                    <label for="questNote">ã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒ¢</label>
                    <textarea id="questNote" placeholder="ã“ã®ã‚¯ã‚¨ã‚¹ãƒˆã«ã¤ã„ã¦ã®ãƒ¡ãƒ¢ã‚’æ®‹ã™"></textarea>
                </div>
                <div class="text-center">
                    <button class="btn btn-primary" onclick="completeQuest()">ã‚¯ã‚¨ã‚¹ãƒˆå®Œäº†</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== Game State =====
        let gameState = {
            currentScreen: 'screen-welcome',
            user: {
                name: '',
                age: '',
                goal: '',
                activity: '',
                path: ''
            },
            quizAnswers: [],
            monsterCards: [],
            heroCards: [],
            skillCards: [],
            quests: [],
            records: [],
            generatedContents: [],
            cycle: 1,
            currentQuestTab: 'monster',
            selectedQuest: null
        };

        // ===== Quiz Data =====
        const quizQuestions = [
            {
                question: "æ–°ã—ã„ã“ã¨ã‚’å§‹ã‚ã‚‹ã¨ãã€ã‚ãªãŸã¯ã©ã†æ„Ÿã˜ã¾ã™ã‹ï¼Ÿ",
                options: [
                    { text: "ãƒ¯ã‚¯ãƒ¯ã‚¯ã—ã¦æ—©ãå§‹ã‚ãŸã„", monster: 0, hero: 2 },
                    { text: "è¨ˆç”»ã‚’ç«‹ã¦ã¦ã‹ã‚‰å§‹ã‚ãŸã„", monster: 1, hero: 1 },
                    { text: "ä¸å®‰ã§èºŠèº‡ã—ã¦ã—ã¾ã†", monster: 2, hero: 0 },
                    { text: "èª°ã‹ã¨ä¸€ç·’ãªã‚‰å§‹ã‚ã‚‰ã‚Œã‚‹", monster: 1, hero: 1 }
                ]
            },
            {
                question: "å›°é›£ã«ç›´é¢ã—ãŸã¨ãã€ã©ã†å¯¾å‡¦ã—ã¾ã™ã‹ï¼Ÿ",
                options: [
                    { text: "ã™ãã«è§£æ±ºç­–ã‚’è€ƒãˆã‚‹", monster: 0, hero: 2 },
                    { text: "ä¸€åº¦é›¢ã‚Œã¦å†·é™ã«ãªã‚‹", monster: 1, hero: 1 },
                    { text: "èª°ã‹ã«ç›¸è«‡ã™ã‚‹", monster: 1, hero: 1 },
                    { text: "é¿ã‘ã¦é€šã‚ŠãŸããªã‚‹", monster: 2, hero: 0 }
                ]
            },
            {
                question: "ãƒãƒ¼ãƒ ã§ä½œæ¥­ã™ã‚‹ã¨ãã€ã‚ãªãŸã®å½¹å‰²ã¯ï¼Ÿ",
                options: [
                    { text: "ãƒªãƒ¼ãƒ€ãƒ¼ã¨ã—ã¦å¼•ã£å¼µã‚‹", monster: 0, hero: 2 },
                    { text: "ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’å‡ºã™", monster: 0, hero: 2 },
                    { text: "ã‚µãƒãƒ¼ãƒˆå½¹ã«å¾¹ã™ã‚‹", monster: 1, hero: 1 },
                    { text: "ä¸€äººã§ä½œæ¥­ã—ãŸã„", monster: 2, hero: 0 }
                ]
            },
            {
                question: "æ™‚é–“ç®¡ç†ã«ã¤ã„ã¦å½“ã¦ã¯ã¾ã‚‹ã®ã¯ï¼Ÿ",
                options: [
                    { text: "è¨ˆç”»é€šã‚Šã«é€²ã‚ã‚‰ã‚Œã‚‹", monster: 0, hero: 2 },
                    { text: "ç· ã‚åˆ‡ã‚Šç›´å‰ã«é›†ä¸­ã™ã‚‹", monster: 1, hero: 1 },
                    { text: "ã¤ã„å…ˆå»¶ã°ã—ã«ã—ã¦ã—ã¾ã†", monster: 2, hero: 0 },
                    { text: "è¤‡æ•°ã®ã“ã¨ã‚’åŒæ™‚ã«ã“ãªã›ã‚‹", monster: 0, hero: 2 }
                ]
            },
            {
                question: "å¤±æ•—ã—ãŸã¨ãã€ã©ã†æ„Ÿã˜ã¾ã™ã‹ï¼Ÿ",
                options: [
                    { text: "å­¦ã³ã®æ©Ÿä¼šã¨ã—ã¦æ‰ãˆã‚‹", monster: 0, hero: 2 },
                    { text: "å°‘ã—è½ã¡è¾¼ã‚€ãŒç«‹ã¡ç›´ã‚‹", monster: 1, hero: 1 },
                    { text: "é•·ãå¼•ããšã£ã¦ã—ã¾ã†", monster: 2, hero: 0 },
                    { text: "æ¬¡ã¯çµ¶å¯¾æˆåŠŸã™ã‚‹ã¨ç‡ƒãˆã‚‹", monster: 0, hero: 2 }
                ]
            },
            {
                question: "æƒ…å ±åé›†ã®æ–¹æ³•ã¯ï¼Ÿ",
                options: [
                    { text: "æœ¬ã‚„ãƒãƒƒãƒˆã§å¾¹åº•çš„ã«èª¿ã¹ã‚‹", monster: 0, hero: 2 },
                    { text: "è©³ã—ã„äººã«ç›´æ¥èã", monster: 0, hero: 2 },
                    { text: "ã¨ã‚Šã‚ãˆãšã‚„ã£ã¦ã¿ã‚‹", monster: 1, hero: 1 },
                    { text: "æƒ…å ±ãŒå¤šã™ãã‚‹ã¨æ··ä¹±ã™ã‚‹", monster: 2, hero: 0 }
                ]
            },
            {
                question: "ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã®æºã¯ï¼Ÿ",
                options: [
                    { text: "é”æˆæ„Ÿã‚„æˆé•·å®Ÿæ„Ÿ", monster: 0, hero: 2 },
                    { text: "äººã‹ã‚‰ã®è©•ä¾¡ã‚„æ„Ÿè¬", monster: 1, hero: 1 },
                    { text: "å ±é…¬ã‚„ã”è¤’ç¾", monster: 1, hero: 1 },
                    { text: "ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ç¶­æŒãŒè‹¦æ‰‹", monster: 2, hero: 0 }
                ]
            },
            {
                question: "ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã¯ï¼Ÿ",
                options: [
                    { text: "ç©æ¥µçš„ã«ç™ºè¨€ã™ã‚‹", monster: 0, hero: 2 },
                    { text: "èãå½¹ãŒå¤šã„", monster: 1, hero: 1 },
                    { text: "æ–‡ç« ã§ã®è¡¨ç¾ãŒå¾—æ„", monster: 0, hero: 2 },
                    { text: "äººã¨è©±ã™ã®ãŒè‹¦æ‰‹", monster: 2, hero: 0 }
                ]
            },
            {
                question: "å‰µé€ æ€§ã«ã¤ã„ã¦å½“ã¦ã¯ã¾ã‚‹ã®ã¯ï¼Ÿ",
                options: [
                    { text: "ã‚¢ã‚¤ãƒ‡ã‚¢ãŒæ¬¡ã€…ã¨æµ®ã‹ã¶", monster: 0, hero: 2 },
                    { text: "æ—¢å­˜ã®ã‚‚ã®ã‚’æ”¹è‰¯ã™ã‚‹ã®ãŒå¾—æ„", monster: 0, hero: 2 },
                    { text: "æŒ‡ç¤ºãŒã‚ã‚Œã°ä½œã‚Œã‚‹", monster: 1, hero: 1 },
                    { text: "å‰µé€ çš„ãªä½œæ¥­ã¯è‹¦æ‰‹", monster: 2, hero: 0 }
                ]
            },
            {
                question: "ã‚¹ãƒˆãƒ¬ã‚¹ç™ºæ•£æ–¹æ³•ã¯ï¼Ÿ",
                options: [
                    { text: "é‹å‹•ã‚„ä½“ã‚’å‹•ã‹ã™", monster: 0, hero: 2 },
                    { text: "è¶£å‘³ã«æ²¡é ­ã™ã‚‹", monster: 0, hero: 2 },
                    { text: "èª°ã‹ã¨è©±ã™", monster: 1, hero: 1 },
                    { text: "ã‚¹ãƒˆãƒ¬ã‚¹ã‚’æºœã‚è¾¼ã¿ã‚„ã™ã„", monster: 2, hero: 0 }
                ]
            }
        ];

        // ===== Card Templates =====
        const monsterTemplates = [
            { name: "å…ˆå»¶ã°ã—ã®é­”ç‰©", desc: "é‡è¦ãªã“ã¨ã‚’å¾Œå›ã—ã«ã™ã‚‹", icon: "ğŸ‘»" },
            { name: "å®Œç’§ä¸»ç¾©ã®äº¡éœŠ", desc: "å®Œç’§ã§ãªã„ã¨å‹•ã‘ãªã„", icon: "ğŸ’€" },
            { name: "æ¯”è¼ƒã®æ‚ªé­”", desc: "ä»–äººã¨æ¯”ã¹ã¦è½ã¡è¾¼ã‚€", icon: "ğŸ‘¿" },
            { name: "ä¸å®‰ã®éœ§", desc: "æœªæ¥ã®ä¸å®‰ã«å›šã‚ã‚Œã‚‹", icon: "ğŸŒ«ï¸" },
            { name: "å­¤ç‹¬ã®å½±", desc: "ä¸€äººã§æŠ±ãˆè¾¼ã‚€", icon: "ğŸ‘¤" },
            { name: "éå»ã®æ€¨éœŠ", desc: "éå»ã®å¤±æ•—ã‚’å¼•ããšã‚‹", icon: "ğŸ‘»" }
        ];

        const heroTemplates = [
            { name: "è¡Œå‹•ã®æˆ¦å£«", desc: "ã™ãã«å®Ÿè¡Œã«ç§»ã›ã‚‹", icon: "âš”ï¸" },
            { name: "åˆ†æã®è³¢è€…", desc: "ç‰©äº‹ã‚’æ·±ãè€ƒå¯Ÿã§ãã‚‹", icon: "ğŸ“š" },
            { name: "å…±æ„Ÿã®ç™’ã—æ‰‹", desc: "äººã®æ°—æŒã¡ã‚’ç†è§£ã§ãã‚‹", icon: "ğŸ’š" },
            { name: "å‰µé€ ã®é­”æ³•ä½¿ã„", desc: "æ–°ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ç”Ÿã‚€", icon: "âœ¨" },
            { name: "ç¶™ç¶šã®é¨å£«", desc: "ã‚³ãƒ„ã‚³ãƒ„ç¶šã‘ã‚‰ã‚Œã‚‹", icon: "ğŸ›¡ï¸" },
            { name: "ä¼é”ã®åŸéŠè©©äºº", desc: "è€ƒãˆã‚’ä¸Šæ‰‹ãä¼ãˆã‚‰ã‚Œã‚‹", icon: "ğŸµ" }
        ];

        const skillTemplates = [
            { name: "æ–‡ç« åŠ›", desc: "æ˜ç¢ºã«ä¼ãˆã‚‹åŠ›", icon: "âœï¸" },
            { name: "åˆ†æåŠ›", desc: "ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è§£ãåŠ›", icon: "ğŸ“Š" },
            { name: "ä¼ç”»åŠ›", desc: "æ–°ã—ã„è¨ˆç”»ã‚’ç«‹ã¦ã‚‹åŠ›", icon: "ğŸ’¡" },
            { name: "ç¶™ç¶šåŠ›", desc: "ç¿’æ…£ã‚’ç¶­æŒã™ã‚‹åŠ›", icon: "ğŸ”„" },
            { name: "ç™ºä¿¡åŠ›", desc: "æƒ…å ±ã‚’åºƒã‚ã‚‹åŠ›", icon: "ğŸ“¢" }
        ];

        // ===== Quest Templates =====
        const questTemplates = {
            monster: [
                { title: "å…ˆå»¶ã°ã—è¨ä¼", desc: "ä»Šæ—¥ã‚„ã‚‹ã¹ãã“ã¨ã‚’3ã¤æ›¸ãå‡ºã—ã€1ã¤ã‚’å®Œäº†ã™ã‚‹", difficulty: 1 },
                { title: "å®Œç’§ä¸»ç¾©ã¨ã®å¯¾è©±", desc: "70%ã®å®Œæˆåº¦ã§ä½•ã‹ã‚’å…¬é–‹ã—ã¦ã¿ã‚‹", difficulty: 2 },
                { title: "æ¯”è¼ƒã®ç½ ã‚’é¿ã‘ã‚‹", desc: "è‡ªåˆ†ã®1ãƒ¶æœˆå‰ã¨æ¯”è¼ƒã—ã¦æˆé•·ã‚’è¨˜éŒ²ã™ã‚‹", difficulty: 1 },
                { title: "ä¸å®‰ã®æ­£ä½“ã‚’æš´ã", desc: "ä¸å®‰ãªã“ã¨ã‚’3ã¤æ›¸ãå‡ºã—ã€å¯¾ç­–ã‚’è€ƒãˆã‚‹", difficulty: 2 },
                { title: "åŠ©ã‘ã‚’æ±‚ã‚ã‚‹", desc: "èª°ã‹ã«ç›¸è«‡ã‚„è³ªå•ã‚’ã—ã¦ã¿ã‚‹", difficulty: 2 }
            ],
            hero: [
                { title: "å³è¡Œå‹•ãƒãƒ£ãƒ¬ãƒ³ã‚¸", desc: "æ€ã„ã¤ã„ãŸã“ã¨ã‚’5åˆ†ä»¥å†…ã«å§‹ã‚ã‚‹", difficulty: 1 },
                { title: "æ·±æ˜ã‚Šåˆ†æ", desc: "èˆˆå‘³ã‚ã‚‹ãƒ†ãƒ¼ãƒã«ã¤ã„ã¦30åˆ†èª¿æŸ»ã™ã‚‹", difficulty: 1 },
                { title: "å…±æ„Ÿã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼", desc: "èª°ã‹ã®è©±ã‚’15åˆ†é–“ã˜ã£ãã‚Šèã", difficulty: 2 },
                { title: "ã‚¢ã‚¤ãƒ‡ã‚¢å‰µå‡º", desc: "1ã¤ã®ãƒ†ãƒ¼ãƒã§10å€‹ã®ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’å‡ºã™", difficulty: 2 },
                { title: "ç¶™ç¶šã®å„€å¼", desc: "å°ã•ãªç¿’æ…£ã‚’1é€±é–“ç¶šã‘ã‚‹", difficulty: 3 },
                { title: "ç™ºä¿¡ã®ç¬¬ä¸€æ­©", desc: "å­¦ã‚“ã ã“ã¨ã‚’SNSã§1ã¤ã‚·ã‚§ã‚¢ã™ã‚‹", difficulty: 1 }
            ]
        };

        // ===== Core Functions =====
        function init() {
            loadGameState();
            updateProgress();
            if (gameState.cycle > 1) {
                // 2å‘¨ç›®ä»¥é™ã¯ã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ
                goToScreen('screen-quests');
            }
        }

        function loadGameState() {
            const saved = localStorage.getItem('bunme_state');
            if (saved) {
                gameState = JSON.parse(saved);
            }
        }

        function saveGameState() {
            localStorage.setItem('bunme_state', JSON.stringify(gameState));
        }

        function goToScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            gameState.currentScreen = screenId;
            updateProgress();
            saveGameState();

            // Screen-specific initialization
            if (screenId === 'screen-quiz') {
                startQuiz();
            } else if (screenId === 'screen-quests') {
                renderQuests();
            } else if (screenId === 'screen-records') {
                renderRecords();
                populateQuestSelect();
            } else if (screenId === 'screen-content') {
                populateContentTopics();
            } else if (screenId === 'screen-goal') {
                updateGoalScreen();
            }
        }

        function updateProgress() {
            const screens = ['screen-register', 'screen-quiz', 'screen-cards', 'screen-path', 'screen-quests', 'screen-records', 'screen-content', 'screen-goal'];
            const currentIndex = screens.indexOf(gameState.currentScreen);
            const progress = Math.max(0, (currentIndex / (screens.length - 1)) * 100);
            document.getElementById('progressFill').style.width = progress + '%';

            // Update step indicators
            const stepMap = {
                'screen-register': 1, 'screen-quiz': 1,
                'screen-cards': 2, 'screen-path': 2,
                'screen-quests': 3,
                'screen-records': 4,
                'screen-content': 5, 'screen-goal': 5
            };
            const currentStep = stepMap[gameState.currentScreen] || 1;

            document.querySelectorAll('.progress-step').forEach(step => {
                const stepNum = parseInt(step.dataset.step);
                step.classList.remove('active', 'completed');
                if (stepNum < currentStep) {
                    step.classList.add('completed');
                } else if (stepNum === currentStep) {
                    step.classList.add('active');
                }
            });
        }

        // ===== Registration =====
        function saveRegistration() {
            const name = document.getElementById('userName').value.trim();
            const age = document.getElementById('userAge').value;
            const goal = document.getElementById('userGoal').value.trim();

            if (!name) {
                alert('åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            gameState.user.name = name;
            gameState.user.age = age;
            gameState.user.goal = goal;
            saveGameState();
            goToScreen('screen-quiz');
        }

        // ===== Quiz System =====
        let currentQuizIndex = 0;
        let monsterScore = 0;
        let heroScore = 0;

        function startQuiz() {
            currentQuizIndex = 0;
            monsterScore = 0;
            heroScore = 0;
            gameState.quizAnswers = [];
            showQuizQuestion();
        }

        function showQuizQuestion() {
            if (currentQuizIndex >= quizQuestions.length) {
                finishQuiz();
                return;
            }

            const q = quizQuestions[currentQuizIndex];
            document.getElementById('quizQuestion').textContent = q.question;
            document.getElementById('quizProgress').textContent = `${currentQuizIndex + 1} / ${quizQuestions.length}`;

            const optionsContainer = document.getElementById('quizOptions');
            optionsContainer.innerHTML = '';

            q.options.forEach((opt, index) => {
                const optDiv = document.createElement('div');
                optDiv.className = 'quiz-option';
                optDiv.textContent = opt.text;
                optDiv.onclick = () => selectQuizOption(index);
                optionsContainer.appendChild(optDiv);
            });
        }

        function selectQuizOption(index) {
            const q = quizQuestions[currentQuizIndex];
            const opt = q.options[index];

            monsterScore += opt.monster;
            heroScore += opt.hero;
            gameState.quizAnswers.push(index);

            // Visual feedback
            document.querySelectorAll('.quiz-option').forEach((o, i) => {
                o.classList.remove('selected');
                if (i === index) o.classList.add('selected');
            });

            setTimeout(() => {
                currentQuizIndex++;
                showQuizQuestion();
            }, 500);
        }

        function finishQuiz() {
            generateCards();
            goToScreen('screen-cards');
        }

        // ===== Card Generation =====
        function generateCards() {
            // Generate monster cards based on score
            const numMonsters = Math.min(3, Math.ceil(monsterScore / 5));
            gameState.monsterCards = [];
            for (let i = 0; i < numMonsters; i++) {
                const template = monsterTemplates[i % monsterTemplates.length];
                gameState.monsterCards.push({
                    id: 'monster_' + i,
                    ...template,
                    level: 1
                });
            }

            // Generate hero cards based on score
            const numHeroes = Math.min(3, Math.ceil(heroScore / 5));
            gameState.heroCards = [];
            for (let i = 0; i < numHeroes; i++) {
                const template = heroTemplates[i % heroTemplates.length];
                gameState.heroCards.push({
                    id: 'hero_' + i,
                    ...template,
                    level: 1
                });
            }

            renderCards();
            generateQuests();
            saveGameState();
        }

        function renderCards() {
            const monsterContainer = document.getElementById('monsterCards');
            const heroContainer = document.getElementById('heroCards');

            monsterContainer.innerHTML = gameState.monsterCards.map(card => `
                <div class="mini-card">
                    <div class="mini-card-icon">${card.icon}</div>
                    <div class="mini-card-name">${card.name}</div>
                    <div class="mini-card-desc">${card.desc}</div>
                </div>
            `).join('');

            heroContainer.innerHTML = gameState.heroCards.map(card => `
                <div class="mini-card">
                    <div class="mini-card-icon">${card.icon}</div>
                    <div class="mini-card-name">${card.name}</div>
                    <div class="mini-card-desc">${card.desc}</div>
                </div>
            `).join('');
        }

        // ===== Path Selection =====
        function selectPath(path) {
            gameState.user.path = path;

            document.querySelectorAll('.path-option').forEach(p => p.classList.remove('selected'));
            document.getElementById('path-' + path).classList.add('selected');

            if (path === 'defined') {
                document.getElementById('definedPathInput').classList.remove('hidden');
            } else {
                document.getElementById('definedPathInput').classList.add('hidden');
            }

            document.getElementById('pathNextBtn').disabled = false;
        }

        function confirmPath() {
            if (gameState.user.path === 'defined') {
                gameState.user.activity = document.getElementById('userActivity').value.trim();
            }
            saveGameState();
            goToScreen('screen-quests');
        }

        // ===== Quest System =====
        function generateQuests() {
            gameState.quests = [];

            // Monster quests
            questTemplates.monster.forEach((q, i) => {
                gameState.quests.push({
                    id: 'quest_m_' + i,
                    type: 'monster',
                    ...q,
                    completed: false,
                    note: ''
                });
            });

            // Hero quests
            questTemplates.hero.forEach((q, i) => {
                gameState.quests.push({
                    id: 'quest_h_' + i,
                    type: 'hero',
                    ...q,
                    completed: false,
                    note: ''
                });
            });

            // Add activity-specific quests if path is defined
            if (gameState.user.path === 'defined' && gameState.user.activity) {
                gameState.quests.push({
                    id: 'quest_custom_1',
                    type: 'hero',
                    title: 'æ´»å‹•ã‚’1æ™‚é–“å®Ÿè·µ',
                    desc: `ã€Œ${gameState.user.activity}ã€ã«1æ™‚é–“å–ã‚Šçµ„ã‚€`,
                    difficulty: 2,
                    completed: false,
                    note: ''
                });
            }

            saveGameState();
        }

        function renderQuests() {
            const questList = document.getElementById('questList');
            const filteredQuests = gameState.quests.filter(q => q.type === gameState.currentQuestTab);

            questList.innerHTML = filteredQuests.map(quest => `
                <div class="quest-item ${quest.completed ? 'completed' : ''}" onclick="openQuestModal('${quest.id}')">
                    <div class="quest-icon ${quest.type}">${quest.type === 'monster' ? 'ğŸ‘¹' : 'âš”ï¸'}</div>
                    <div class="quest-info">
                        <div class="quest-title">${quest.title}</div>
                        <div class="quest-desc">${quest.desc}</div>
                    </div>
                    <span class="quest-status ${quest.completed ? 'status-completed' : 'status-pending'}">
                        ${quest.completed ? 'å®Œäº†' : 'æœªå®Œäº†'}
                    </span>
                </div>
            `).join('');

            // Update stats
            const completed = gameState.quests.filter(q => q.completed).length;
            document.getElementById('completedQuests').textContent = completed;
            document.getElementById('totalRecords').textContent = gameState.records.length;
        }

        function switchQuestTab(tab) {
            gameState.currentQuestTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            renderQuests();
        }

        function openQuestModal(questId) {
            const quest = gameState.quests.find(q => q.id === questId);
            if (!quest) return;

            gameState.selectedQuest = questId;
            document.getElementById('modalQuestTitle').textContent = quest.title;
            document.getElementById('modalQuestDesc').textContent = quest.desc;
            document.getElementById('questNote').value = quest.note || '';
            document.getElementById('questModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('questModal').classList.remove('active');
            gameState.selectedQuest = null;
        }

        function completeQuest() {
            if (!gameState.selectedQuest) return;

            const quest = gameState.quests.find(q => q.id === gameState.selectedQuest);
            if (quest) {
                quest.completed = true;
                quest.note = document.getElementById('questNote').value;

                // Check for skill acquisition
                checkSkillAcquisition();
            }

            saveGameState();
            closeModal();
            renderQuests();
        }

        function checkSkillAcquisition() {
            const completedCount = gameState.quests.filter(q => q.completed).length;

            // Award skill every 3 completed quests
            if (completedCount > 0 && completedCount % 3 === 0) {
                const skillIndex = Math.floor(completedCount / 3) - 1;
                if (skillIndex < skillTemplates.length && !gameState.skillCards.find(s => s.id === 'skill_' + skillIndex)) {
                    const template = skillTemplates[skillIndex];
                    gameState.skillCards.push({
                        id: 'skill_' + skillIndex,
                        ...template,
                        level: 1,
                        acquiredAt: new Date().toISOString()
                    });
                    alert(`æ–°ã—ã„ã‚¹ã‚­ãƒ«ã€Œ${template.name}ã€ã‚’ç²å¾—ã—ã¾ã—ãŸï¼`);
                }
            }
        }

        // ===== Activity Records =====
        function populateQuestSelect() {
            const select = document.getElementById('recordQuest');
            select.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>';

            gameState.quests.forEach(quest => {
                const option = document.createElement('option');
                option.value = quest.id;
                option.textContent = quest.title;
                select.appendChild(option);
            });
        }

        function saveRecord() {
            const title = document.getElementById('recordTitle').value.trim();
            const content = document.getElementById('recordContent').value.trim();
            const questId = document.getElementById('recordQuest').value;

            if (!title || !content) {
                alert('ã‚¿ã‚¤ãƒˆãƒ«ã¨è©³ç´°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            gameState.records.push({
                id: 'record_' + Date.now(),
                title,
                content,
                questId,
                createdAt: new Date().toISOString()
            });

            // Clear form
            document.getElementById('recordTitle').value = '';
            document.getElementById('recordContent').value = '';
            document.getElementById('recordQuest').value = '';

            saveGameState();
            renderRecords();

            // Update stats
            document.getElementById('totalRecords').textContent = gameState.records.length;
        }

        function renderRecords() {
            const log = document.getElementById('activityLog');

            if (gameState.records.length === 0) {
                log.innerHTML = '<p style="color: var(--text-muted); text-align: center;">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }

            log.innerHTML = gameState.records.slice().reverse().map(record => {
                const date = new Date(record.createdAt).toLocaleDateString('ja-JP');
                return `
                    <div class="activity-entry">
                        <strong>${record.title}</strong>
                        <p>${record.content.substring(0, 100)}${record.content.length > 100 ? '...' : ''}</p>
                        <div class="activity-date">${date}</div>
                    </div>
                `;
            }).join('');
        }

        // ===== Content Generation =====
        let currentContentType = 'blog';

        function selectContentType(type) {
            currentContentType = type;
            document.querySelectorAll('.content-type-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.toLowerCase().includes(type) ||
                    (type === 'sns' && btn.textContent === 'SNSæŠ•ç¨¿') ||
                    (type === 'newsletter' && btn.textContent === 'ãƒ¡ãƒ«ãƒã‚¬')) {
                    btn.classList.add('active');
                }
            });
        }

        function populateContentTopics() {
            const select = document.getElementById('contentTopic');
            select.innerHTML = '<option value="">æ´»å‹•è¨˜éŒ²ã‹ã‚‰é¸æŠ</option>';

            gameState.records.forEach(record => {
                const option = document.createElement('option');
                option.value = record.id;
                option.textContent = record.title;
                select.appendChild(option);
            });
        }

        function generateContent() {
            const topicId = document.getElementById('contentTopic').value;
            const record = gameState.records.find(r => r.id === topicId);

            if (!record) {
                alert('è¨˜éŒ²ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            let content = '';
            const userName = gameState.user.name;

            switch (currentContentType) {
                case 'blog':
                    content = generateBlogContent(record, userName);
                    break;
                case 'sns':
                    content = generateSNSContent(record, userName);
                    break;
                case 'newsletter':
                    content = generateNewsletterContent(record, userName);
                    break;
            }

            document.getElementById('contentOutput').innerHTML = `<pre style="white-space: pre-wrap;">${content}</pre>`;

            gameState.generatedContents.push({
                id: 'content_' + Date.now(),
                type: currentContentType,
                content,
                recordId: topicId,
                createdAt: new Date().toISOString()
            });

            saveGameState();
        }

        function generateBlogContent(record, userName) {
            return `ã€${record.title}ã€‘

${userName}ã§ã™ã€‚

ä»Šæ—¥ã¯ã€Œ${record.title}ã€ã«ã¤ã„ã¦æ›¸ãã¾ã™ã€‚

${record.content}

ã“ã®çµŒé¨“ã‹ã‚‰å­¦ã‚“ã ã“ã¨ã¯ã€
ãƒ»å®Ÿè·µã™ã‚‹ã“ã¨ã®å¤§åˆ‡ã•
ãƒ»æŒ¯ã‚Šè¿”ã‚Šã®é‡è¦æ€§
ãƒ»å°ã•ãªä¸€æ­©ã‚’ç©ã¿é‡ã­ã‚‹ã“ã¨

ã§ã™ã€‚

çš†ã•ã‚“ã‚‚ä½•ã‹æ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã—ã¦ã¿ã¦ã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ï¼Ÿ

æœ€å¾Œã¾ã§èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚`;
        }

        function generateSNSContent(record, userName) {
            return `ã€${record.title}ã€‘ã«æŒ‘æˆ¦ã—ã¾ã—ãŸï¼

${record.content.substring(0, 100)}...

å°ã•ãªä¸€æ­©ã§ã‚‚å‰ã«é€²ã‚€ã“ã¨ãŒå¤§åˆ‡ã ã¨å®Ÿæ„Ÿã—ã¾ã—ãŸã€‚

#æŒ‘æˆ¦ #æˆé•· #BUNME`;
        }

        function generateNewsletterContent(record, userName) {
            return `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${userName}ã®æˆé•·æ—¥è¨˜
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â–  ä»Šå›ã®ãƒ†ãƒ¼ãƒ
${record.title}

â–  æœ¬æ–‡
${record.content}

â–  æ°—ã¥ãã¨å­¦ã³
ã“ã®æ´»å‹•ã‚’é€šã˜ã¦ã€è‡ªå·±ç†è§£ãŒæ·±ã¾ã‚Šã¾ã—ãŸã€‚
æ¬¡ã¯æ›´ã«ã‚¹ãƒ†ãƒƒãƒ—ã‚¢ãƒƒãƒ—ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ¬¡å›ã‚‚ãŠæ¥½ã—ã¿ã«ï¼`;
        }

        // ===== Goal Screen =====
        function updateGoalScreen() {
            document.getElementById('goalName').textContent = gameState.user.name || 'å†’é™ºè€…';

            // Set title based on progress
            const completed = gameState.quests.filter(q => q.completed).length;
            let title = 'è¦‹ç¿’ã„å†’é™ºè€…';
            if (completed >= 10) title = 'ç†Ÿç·´ã®æ¢æ±‚è€…';
            else if (completed >= 5) title = 'æˆé•·ã™ã‚‹å†’é™ºè€…';
            else if (completed >= 3) title = 'é§†ã‘å‡ºã—ã®å†’é™ºè€…';
            document.getElementById('goalTitle').textContent = title;

            // Update stats
            document.getElementById('finalQuests').textContent = completed;
            document.getElementById('finalRecords').textContent = gameState.records.length;
            document.getElementById('finalContents').textContent = gameState.generatedContents.length;
            document.getElementById('finalSkills').textContent = gameState.skillCards.length;

            // Render skill cards
            const skillContainer = document.getElementById('skillCards');
            if (gameState.skillCards.length === 0) {
                skillContainer.innerHTML = '<p style="color: var(--text-muted);">ã¾ã ã‚¹ã‚­ãƒ«ã‚’ç²å¾—ã—ã¦ã„ã¾ã›ã‚“</p>';
            } else {
                skillContainer.innerHTML = gameState.skillCards.map(card => `
                    <div class="mini-card">
                        <div class="mini-card-icon">${card.icon}</div>
                        <div class="mini-card-name">${card.name}</div>
                        <div class="mini-card-desc">${card.desc}</div>
                    </div>
                `).join('');
            }
        }

        function startNewCycle() {
            if (!confirm('2å‘¨ç›®ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿé€²æ—ã¯ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ãŒã€ã‚¹ã‚­ãƒ«ã‚«ãƒ¼ãƒ‰ã¯å¼•ãç¶™ãŒã‚Œã¾ã™ã€‚')) {
                return;
            }

            // Keep skills, reset progress
            const skills = gameState.skillCards;
            const user = gameState.user;
            const cycle = gameState.cycle + 1;

            gameState = {
                currentScreen: 'screen-quests',
                user: user,
                quizAnswers: [],
                monsterCards: gameState.monsterCards,
                heroCards: gameState.heroCards,
                skillCards: skills,
                quests: [],
                records: [],
                generatedContents: [],
                cycle: cycle,
                currentQuestTab: 'monster',
                selectedQuest: null
            };

            // Generate new quests for new cycle
            generateQuests();
            saveGameState();
            goToScreen('screen-quests');

            alert(`${cycle}å‘¨ç›®ã‚’é–‹å§‹ã—ã¾ã—ãŸï¼`);
        }

        function exportData() {
            const data = JSON.stringify(gameState, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bunme_data_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ===== Initialize =====
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
